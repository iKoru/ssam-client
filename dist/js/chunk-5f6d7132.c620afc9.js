(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5f6d7132"],{"0586":function(t,e,s){},2558:function(t,e,s){},"437a":function(t,e,s){"use strict";var r=s("2558"),n=s.n(r);n.a},"475a":function(t,e,s){},5347:function(t,e,s){"use strict";var r=s("c1df"),n=s.n(r),a={data:function(){return{boardTypeItems:{T:"토픽",L:"라운지",D:"아카이브",X:"게시판",E:"전직교사",N:"예비교사"},webUrl:"https://pedagy.com"}},methods:{uuid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var s=t.split(",")[0].split(":")[1].split(";")[0],r=new Uint8Array(e.length),n=0;n<e.length;n++)r[n]=e.charCodeAt(n);return new Blob([r],{type:s})},timeParser:function(t){return n()(t,"YYYYMMDDHHmmss").fromNow()}}};e["a"]=a},"88dd":function(t,e,s){"use strict";var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.survey?s("v-layout",{staticClass:"border-light py-2",attrs:{column:""}},[s("v-flex",[s("v-layout",{attrs:{row:"","align-center":"","mx-2":""}},[t.onlyView?s("span",{staticClass:"subheading"},[t._v("글 작성 후에 수정/삭제가 불가능합니다.")]):s("span",{staticClass:"subheading"},[t._v("설문조사")]),s("v-spacer"),s("span",{directives:[{name:"show",rawName:"v-show",value:t.finalResults,expression:"finalResults"}],staticStyle:{"white-space":"nowrap"}},[t._v("\n        "+t._s(t.survey.participants)+"명 참여\n      ")])],1)],1),t._l(t.survey.surveyContents.questions,function(e,r){return s("v-flex",{key:r,staticClass:"px-3 pt-2"},[s("div",{attrs:{id:"poll"}},[s("div",{staticClass:"font-weight-bold body-2 mb-2"},[t._v(t._s(r+1+". "+e.title)),e.allowMultipleChoice?s("small",{staticClass:"grey--text lighten-1"},[t._v("(복수응답)")]):t._e()]),s("div",{staticClass:"ans-cnt"},t._l(e.choices,function(n,a){return s("div",{key:a,staticClass:"ans"},[t.finalResults?[s("div",{class:{"ans-voted final multi-row":!0,selected:n.selected,"font-weight-bold":e.mostVotes==n.votes}},[n.percent?s("span",{staticClass:"percent"},[t._v(t._s(n.percent))]):t._e(),s("span",{staticClass:"txt"},[t._v(t._s(n.text))])]),s("span",{staticClass:"bg",style:{width:n.percent}})]:[s("div",{class:{"ans-no-vote multi-row":!0,active:n.selected},on:{click:function(e){t.handleVote(r,n)}}},[s("span",{staticClass:"txt"},[t._v(t._s(n.text))])]),s("span",{staticClass:"bg"})]],2)}),0)]),r+1!==t.survey.surveyContents.questions.length?s("v-divider",{key:"divider"+r,staticClass:"mt-3"}):t._e()],1)}),t.survey.participated||t.onlyView?t._e():s("v-flex",[s("v-layout",{attrs:{"justify-center":"","my-2":""}},[s("v-btn",{attrs:{small:""},on:{click:function(e){t.showSurveyResult=!t.showSurveyResult}}},[t._v("\n        "+t._s(t.showSurveyResult?"돌아가기":"결과보기")+"\n      ")]),s("v-btn",{attrs:{small:"",color:"primary",disabled:t.finalResults},on:{click:t.completeSurvey}},[t._v("응답하기")])],1)],1)],2):t._e()},n=[],a={props:["currentSurvey","onlyView"],data:function(){return{showSurveyResult:!1,survey:null}},created:function(){this.survey=this.formatSurvey(this.currentSurvey)},computed:{finalResults:function(){return this.survey.participated||this.showSurveyResult}},methods:{formatSurvey:function(t){var e=t.surveyAnswers;return t.surveyContents.questions.forEach(function(t,s){var r=[],n=0,a=0;t.choices.forEach(function(t,i){e.length>s?(r.push({text:t,selected:!1,votes:e[s][i]}),e[s][i]>n&&(n=e[s][i]),a+=e[s][i]):r.push({text:t,selected:!1,votes:0})}),t.mostVotes=n,t.totalVotes=a,0===a?r.forEach(function(t){t.percent="0%"}):r.forEach(function(t){t.percent=!isNaN(t.votes)&&t.votes>0?Math.round(parseInt(t.votes)/a*100)+"%":"0%"}),t.choices=r}),t},getAnswerArray:function(t){var e=[];return t.forEach(function(t){if(t.allowMultipleChoice){var s=[];t.choices.forEach(function(t,e){t.selected&&s.push(e)}),e.push(s)}else e.push(t.choices.findIndex(function(t){return t.selected}))}),e},completeSurvey:function(){var t=this;if(this.survey.surveyContents.questions.every(function(t){return t.choices.some(function(t){return t.selected})})){if(this.survey.participated)return void this.$store.dispatch("showSnackbar",{text:"이미 참여한 설문입니다.",color:"info"});var e=this.getAnswerArray(this.survey.surveyContents.questions);this.$axios.post("/survey",{documentId:this.$route.params.documentId,answer:e}).then(function(e){console.log(e),e.data.survey?(t.survey=t.formatSurvey(e.data.survey),t.showSurveyResult=!0):t.$axios.get("/".concat(t.$route.params.boardId,"/").concat(t.$route.params.documentId)).then(function(e){t.survey=t.formatSurvey(e.data.survey),console.log(t.survey),t.showSurveyResult=!0}).catch(function(t){console.log(t)})}).catch(function(e){e.response&&409===e.response.status?t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"info"}):t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"error"})})}else this.$store.dispatch("showSnackbar",{text:this.survey.surveyContents.questions.findIndex(function(t){return!t.choices.some(function(t){return t.selected})})+1+"번 질문의 응답을 선택해주세요.",color:"warning"})},handleVote:function(t,e){this.survey.surveyContents.questions[t].allowMultipleChoice||e.selected||this.survey.surveyContents.questions[t].choices.forEach(function(t){return t.selected=!1}),e.selected=!e.selected}}},i=a,o=(s("437a"),s("0c7c")),c=Object(o["a"])(i,r,n,!1,null,null,null);e["a"]=c.exports},ace1:function(t,e,s){"use strict";var r=s("475a"),n=s.n(r);n.a},b76b:function(t,e,s){"use strict";var r=s("0586"),n=s.n(r);n.a},ec84:function(t,e,s){"use strict";s.r(e);var r=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-layout",{attrs:{column:"","mx-1":t.$vuetify.breakpoint.smAndUp,"mt-1":t.$vuetify.breakpoint.smAndUp}},[s("v-flex",{staticClass:"mb-0 pb-0",attrs:{id:"title"}},[s("v-text-field",{staticClass:"dense",attrs:{placeholder:"제목",flat:t.$vuetify.breakpoint.xsOnly,solo:"","hide-details":""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),s("v-flex",{attrs:{xs12:"",id:"write-editor"}},[s("quill-editor",{ref:"editor",attrs:{options:t.editorOption},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}},[s("div",{attrs:{slot:"toolbar",id:"toolbar"},slot:"toolbar"},[s("button",{staticClass:"ql-bold"},[t._v("Bold")]),s("button",{staticClass:"ql-italic"},[t._v("Italic")]),s("select",{staticClass:"ql-size"},[s("option",{attrs:{value:"small"}},[t._v("작게")]),s("option",{attrs:{selected:""}},[t._v("보통")]),s("option",{attrs:{value:"large"}},[t._v("크게")]),s("option",{attrs:{value:"huge"}},[t._v("더 크게")])])])])],1),s("div",[t._v(t._s(t.savedContent))]),s("v-dialog",{attrs:{"max-width":"500px",fullscreen:t.$vuetify.breakpoint.xsOnly,scrollable:""},model:{value:t.surveyDialog,callback:function(e){t.surveyDialog=e},expression:"surveyDialog"}},[s("survey-maker",{attrs:{survey:t.currentSurvey},on:{deleteSurvey:t.deleteSurvey,closeSurvey:t.closeSurvey,extractSurvey:t.extractSurvey}})],1),s("v-layout",{attrs:{"pt-1":"","align-center":""}},[s("div",[s("v-btn",{attrs:{small:"",flat:"",color:t.survey?"primary":"default"},on:{click:t.surveyButtonClick}},[s("v-icon",{attrs:{id:"survey-button"}},[t._v("how_to_vote")]),s("span",[t._v("설문조사")])],1)],1),s("div",[s("v-btn",{attrs:{small:"",flat:""},on:{click:t.selectImage}},[s("v-icon",{attrs:{id:"attach-button"}},[t._v("image")]),t._v("이미지\n      ")],1)],1),s("div",[s("v-btn",{attrs:{small:"",flat:""},on:{click:t.openFileDialog}},[s("v-icon",{attrs:{id:"attach-button"}},[t._v("attach_file")]),t._v("파일첨부\n      ")],1)],1)]),s("input",{ref:"fileInput",staticStyle:{diplay:"none!important",height:"0px",width:"0px"},attrs:{multiple:"",id:"file-upload",accept:"image/*",type:"file",value:"",capture:"filesystem"},on:{click:function(e){t.$refs.fileInput.value=null},change:t.onFileChange}}),s("v-slide-y-transition",[t.attachedFilenames.length>0?s("v-layout",{staticClass:"border-light",attrs:{wrap:""}},t._l(t.attachedFilenames,function(e,r){return s("v-flex",{key:r,attrs:{xs6:"",md4:"","px-2":""}},[s("v-slide-y-transition",[s("v-layout",{attrs:{row:"","align-center":""}},[s("div",{staticClass:"ellipsis"},[t._v(t._s(e))]),s("v-spacer"),s("v-btn",{staticClass:"short",attrs:{small:""},on:{click:function(e){t.removeFile(r)}}},[t._v("삭제")])],1)],1)],1)}),1):t._e()],1),t.documentId&&t.survey?s("v-dialog",{attrs:{"max-width":"500px",fullscreen:t.$vuetify.breakpoint.xsOnly,scrollable:""},model:{value:t.surveyViewerDialog,callback:function(e){t.surveyViewerDialog=e},expression:"surveyViewerDialog"}},[s("v-card",[s("v-toolbar",{attrs:{flat:""}},[s("v-toolbar-title",[t._v("설문조사 확인")]),s("v-spacer"),s("v-btn",{staticClass:"toolbar-btn-last",attrs:{icon:""},on:{click:function(e){t.surveyViewerDialog=!1}}},[s("v-icon",[t._v("close")])],1)],1),s("v-card-text",[s("v-layout",{attrs:{column:""}},[s("survey",{attrs:{currentSurvey:t.survey,onlyView:!0}})],1)],1)],1)],1):t._e(),s("v-layout",{attrs:{"py-2":"","ml-3":"","justify-center":""}},[s("div",{staticClass:"mr-3"},[s("v-checkbox",{staticClass:"mr-1 my-auto mb-0",attrs:{"hide-details":"",label:"익명"},model:{value:t.isAnonymous,callback:function(e){t.isAnonymous=e},expression:"isAnonymous"}})],1),s("div",[s("v-checkbox",{staticClass:"mr-1 my-auto mb-0",attrs:{disabled:t.isAnonymous,"hide-details":"",label:"익명댓글불가"},model:{value:t.disallowAnonymous,callback:function(e){t.disallowAnonymous=e},expression:"disallowAnonymous"}})],1),s("v-spacer")],1),s("v-layout",{attrs:{row:""}},[s("v-flex",{attrs:{"text-xs-center":""}},[s("v-btn",{on:{click:function(e){t.$router.go(-1)}}},[t._v("돌아가기")]),s("v-btn",{staticClass:"primary",on:{click:function(e){t.post()}}},[t._v(t._s(t.documentId?"수정하기":"등록"))])],1)],1)],1)},n=[],a=s("a34a"),i=s.n(a),o=s("88dd"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",[s("v-toolbar",{attrs:{flat:""}},[s("v-toolbar-title",[t._v("설문조사")]),s("v-spacer"),s("v-btn",{staticClass:"toolbar-btn-last",attrs:{icon:""},on:{click:function(e){t.$emit("closeSurvey")}}},[s("v-icon",[t._v("close")])],1)],1),s("v-card-text",[s("v-layout",{attrs:{column:""}},[s("div",{staticClass:"border-light",attrs:{id:"surveyMaker"}},t._l(t.currentSurvey.questions,function(e,r){return s("v-flex",{key:r},[s("v-card",{attrs:{flat:""}},[s("v-card-title",{staticClass:"pb-1"},[t._v("\n              "+t._s(r+1)+".\n              "),s("v-text-field",{staticClass:"dense mt-0 pt-0 ml-2",attrs:{"single-line":"","hide-details":"",dense:"",placeholder:"질문 내용","append-outer-icon":"close"},on:{"click:append-outer":function(e){t.deleteQuestion(r)}},model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"question.title"}})],1),s("v-card-text",{staticClass:"py-0"},[s("v-layout",{attrs:{column:""}},[t._l(e.choices,function(n,a){return s("v-flex",{key:a,staticClass:"mt-2"},[s("v-text-field",{staticClass:"pt-1 dense",attrs:{box:"","single-line":"",placeholder:"선택지"+(a+1),"hide-details":"","append-icon":"remove_circle_outline"},on:{"click:append":function(e){t.deleteAnswer(r,a)}},model:{value:e.choices[a],callback:function(s){t.$set(e.choices,a,s)},expression:"question.choices[answerIndex]"}})],1)}),s("v-flex",[s("v-layout",{attrs:{row:"","align-center":"","justify-space-around":""}},[s("v-flex",{attrs:{"text-xs-center":""}},[s("v-btn",{attrs:{flat:""},on:{click:function(e){t.addAnswer(r)}}},[s("v-icon",{staticClass:"mr-1",attrs:{small:""}},[t._v("add_circle_outline")]),t._v("선택지 추가\n                      ")],1)],1),s("v-flex",{attrs:{"text-xs-center":""}},[s("v-checkbox",{staticClass:"mt-0 pt-0",attrs:{"hide-details":"",label:"복수응답 허용"},model:{value:e.allowMultipleChoice,callback:function(s){t.$set(e,"allowMultipleChoice",s)},expression:"question.allowMultipleChoice"}})],1)],1)],1)],2)],1)],1),r!==t.currentSurvey.questions.length-1?s("v-divider",{staticClass:"mx-4"}):t._e()],1)}),1),s("v-flex",[s("v-btn",{attrs:{block:""},on:{click:t.pushQuestion}},[s("v-icon",[t._v("playlist_add")]),s("v-label",{attrs:{size:"24"}},[t._v("질문추가")])],1)],1)],1)],1),s("v-card-actions",{staticClass:"align-start"},[s("v-spacer"),s("v-btn",{attrs:{color:"error",depressed:""},on:{click:function(e){t.$emit("deleteSurvey")}}},[t._v("설문 삭제")]),s("v-btn",{attrs:{color:"primary",depressed:""},on:{click:t.extractSurvey}},[t._v("저장")])],1)],1)},l=[],u={props:["survey","surveyDialog"],data:function(){return{currentSurvey:{}}},methods:{addAnswer:function(t){this.currentSurvey.questions[t].choices.push("")},deleteAnswer:function(t,e){this.currentSurvey.questions[t].choices.length<3?this.currentSurvey.questions[t].choices[e]&&this.currentSurvey.questions[t].choices[e].length>0?(this.currentSurvey.questions[t].choices[e]="",this.$forceUpdate()):this.$store.dispatch("showSnackbar",{text:"선택지는 2개 이상이어야 합니다.",color:"info"}):this.currentSurvey.questions[t].choices.splice(e,1)},pushQuestion:function(){this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]})},deleteQuestion:function(t){1===this.currentSurvey.questions.length?this.currentSurvey.questions[t].title&&this.currentSurvey.questions[t].title.length>0||this.currentSurvey.questions[t].choices.some(function(t){return t&&t.length>0})?(this.currentSurvey.questions.splice(t,1),this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]})):this.$store.dispatch("showSnackbar",{text:"최소 하나 이상의 질문을 입력해주세요",color:"warning"}):this.currentSurvey.questions.splice(t,1)},extractSurvey:function(){var t=0;while(t<this.currentSurvey.questions.length)if(this.currentSurvey.questions[t].title&&this.currentSurvey.questions[t].title.length>0){if(!(this.currentSurvey.questions[t].choices.filter(function(t){return t&&t.length>0}).length>1))return void this.$store.dispatch("showSnackbar",{text:t+1+"번째 질문의 응답을 2개 이상으로 입력해주세요.",color:"info"});this.currentSurvey.questions[t].choices=this.currentSurvey.questions[t].choices.filter(function(t){return t&&t.length>0}),t++}else{if(this.currentSurvey.questions[t].choices.some(function(t){return t&&t.length>0}))return void this.$store.dispatch("showSnackbar",{text:t+1+"번째 질문의 제목을 입력해주세요.",color:"info"});this.currentSurvey.questions.splice(t,1)}0!==t?this.$emit("extractSurvey",this.currentSurvey):this.$store.dispatch("showSnackbar",{text:"질문을 1개 이상 입력해주세요.",color:"warning"})}},watch:{survey:{handler:function(t){this.currentSurvey=t},deep:!0,immediate:!0}}},h=u,v=(s("b76b"),s("0c7c")),d=Object(v["a"])(h,c,l,!1,null,null,null),f=d.exports,p=s("5347");function m(t,e,s,r,n,a,i){try{var o=t[a](i),c=o.value}catch(l){return void s(l)}o.done?e(c):Promise.resolve(c).then(r,n)}function y(t){return function(){var e=this,s=arguments;return new Promise(function(r,n){var a=t.apply(e,s);function i(t){m(a,r,n,i,o,"next",t)}function o(t){m(a,r,n,i,o,"throw",t)}i(void 0)})}}var g={name:"Editor",components:{SurveyMaker:f,Survey:o["a"]},props:["documentId","boardId"],mixins:[p["a"]],data:function(){return{savedContent:void 0,link:void 0,title:null,content:"",survey:void 0,surveyDialog:!1,surveyViewerDialog:!1,currentSurvey:{questions:[]},editorOption:{placeholder:"내용을 입력해주세요.",modules:{toolbar:"#toolbar",magicUrl:{urlRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,globalRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,normalizeRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/},imageDrop:!0,imageResize:!0},theme:this.$vuetify.breakpoint.xsOnly?"bubble":"snow"},show:!1,isAnonymous:!1,disallowAnonymous:!1,formData:void 0,rawFileData:void 0,attachedFilenames:[],attachFromServer:void 0,originImages:[]}},methods:{onEditorChange:function(t){var e=t.quill,s=t.html,r=t.text;console.log("editor change!",e,s,r),this.content=s},post:function(){var t=y(i.a.mark(function t(){return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.title&&""!==this.title.trim()){t.next=5;break}return this.$store.dispatch("showSnackbar",{text:"제목을 입력해주세요.",color:"error"}),t.abrupt("return");case 5:if(this.content&&""!==this.content.trim()){t.next=8;break}return this.$store.dispatch("showSnackbar",{text:"내용을 입력해주세요.",color:"error"}),t.abrupt("return");case 8:if(!this.documentId){t.next=13;break}return t.next=11,this.uploadModifiedDocument();case 11:t.next=15;break;case 13:return t.next=15,this.uploadDocument();case 15:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),uploadDocument:function(){var t=y(i.a.mark(function t(){var e=this;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log(this.$refs.editor.quill.editor.delta),this.formData||(this.formData=new FormData),t.next=4,this.attachImages();case 4:return this.formData.append("boardId",this.$route.params.boardId),this.formData.append("title",this.title),this.formData.append("contents",JSON.stringify(this.$refs.editor.quill.editor.delta)),this.formData.append("isAnonymous",this.isAnonymous),this.formData.append("allowAnonymous",!!this.isAnonymous||!this.disallowAnonymous),this.survey&&this.formData.append("survey",JSON.stringify(this.survey)),t.next=12,this.processUploadFiles();case 12:return t.abrupt("return",this.$axios.post("/document",this.formData).then(function(t){200===t.status&&e.$router.push("/".concat(e.$route.params.boardId,"/").concat(t.data.documentId))}).catch(function(t){e.$store.dispatch("showSnackbar",{text:"게시물 작성이 실패하였습니다. 다시 시도해주세요",color:"error"}),delete e.formData,e.revertImages(),console.log(t.response)}));case 13:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),uploadModifiedDocument:function(){var t=y(i.a.mark(function t(){var e,s=this;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(confirm("게시물을 수정하시겠습니까?")){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,this.formData||(this.formData=new FormData),this.formData.append("documentId",this.documentId),t.next=7,this.attachImages();case 7:return t.next=9,this.processFileChange();case 9:return e={documentId:this.documentId,title:this.title,contents:JSON.stringify(this.$refs.editor.quill.editor.delta)},t.abrupt("return",this.$axios.put("/document",e).then(function(t){200===t.status&&(s.$store.dispatch("showSnackbar",{text:"게시물을 수정하였습니다",color:"success"}),s.$router.push("/".concat(s.$route.params.boardId,"/").concat(s.documentId)))}).catch(function(t){s.$store.dispatch("showSnackbar",{text:"게시물 수정에 실패했습니다. 다시 시도해주세요",color:"error"}),console.log(t.response)}));case 13:t.prev=13,t.t0=t["catch"](2),console.log(t.t0),this.$store.dispatch("showSnackbar",{text:"게시물 수정에 실패했습니다. 다시 시도해주세요",color:"error"}),this.revertImages(),delete this.formData;case 19:case"end":return t.stop()}},t,this,[[2,13]])}));function e(){return t.apply(this,arguments)}return e}(),attachImages:function(){var t=this;return this.$refs.editor.quill.editor.delta.ops.forEach(function(e){if(e.insert.hasOwnProperty("image")){if(console.log(e.insert),e.insert.image.includes("data:image")){var s=e.insert.image,r=t.uuid()+"."+s.substring("data:image/".length,s.indexOf(";base64"));t.formData.append("attach",t.dataURItoBlob(s),r),e.insert.image=r,t.originImages.push({name:r,src:s})}console.log(e.insert)}})},revertImages:function(){var t=this;this.$refs.editor.quill.editor.delta.ops.forEach(function(e){if(e.insert.hasOwnProperty("image")){var s=e.insert.image;e.insert.image=t.originImages.find(function(t){return t.name===s}).src}}),this.originImages=[]},processFileChange:function(){var t=y(i.a.mark(function t(){var e,s,r,n,a,o,c,l,u,h,v,d=this;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return console.log(this.attachFromServer),e=this.$refs.editor.quill.editor.delta.ops.map(function(t){if(t.insert.hasOwnProperty("image")&&t.insert.image.startsWith("/attach"))return d.attachFromServer.find(function(e){return t.insert.image==="/"+e.attach_path}).attach_id}),console.log(e),console.log(this.attachFromServer),this.attachFromServer=this.attachFromServer.filter(function(t){return null!==t}),this.attachFromServer.forEach(function(t){console.log(t.attach_name),t.insert&&!e.filter(function(t){return void 0!==t}).includes(t.attach_id)?s=d.$axios.delete("/document/attach/".concat(d.documentId,"/").concat(t.attach_id)).then(function(t){200===t.status&&console.log(t)}).catch(function(t){console.log(t.response)}):d.attachedFilenames.includes(t.attach_name)||t.insert||(r=d.$axios.delete("/document/attach/".concat(d.documentId,"/").concat(t.attach_id)).then(function(t){200===t.status&&console.log(t)}).catch(function(t){console.log(t.response)}))}),t.next=8,this.processUploadFiles();case 8:for(a=0,o=!0,c=!1,l=void 0,t.prev=12,u=this.formData.entries()[Symbol.iterator]();!(o=(h=u.next()).done);o=!0)v=h.value,"attach"===v[0]&&(a+=1);t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](12),c=!0,l=t.t0;case 20:t.prev=20,t.prev=21,o||null==u.return||u.return();case 23:if(t.prev=23,!c){t.next=26;break}throw l;case 26:return t.finish(23);case 27:return t.finish(20);case 28:return a>0&&(n=this.$axios.post("/document/attach",this.formData).then(function(t){200===t.status&&console.log(t)}).catch(function(t){console.log(t.response)})),t.next=31,Promise.all([s,r,n]).then(function(t){console.log(t)}).catch(function(t){console.log(t),d.$store.dispatch("showSnackbar",{text:"게시물 수정에 실패했습니다. 다시 시도해주세요",color:"error"})});case 31:case"end":return t.stop()}},t,this,[[12,16,20,28],[21,,23,27]])}));function e(){return t.apply(this,arguments)}return e}(),surveyButtonClick:function(){this.documentId&&this.survey?this.surveyViewerDialog=!0:!this.documentId||this.survey?(0===this.currentSurvey.questions.length?this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]}):this.survey&&(this.currentSurvey=JSON.parse(JSON.stringify(this.survey))),this.surveyDialog=!0):this.$store.dispatch("showSnackbar",{text:"게시물 작성 후 설문을 추가할 수 없습니다.",color:"error"})},extractSurvey:function(t){this.surveyDialog=!1,this.survey=JSON.parse(JSON.stringify(t))},closeSurvey:function(){this.surveyDialog=!1},deleteSurvey:function(){confirm("작성된 질문 및 내용을 삭제할까요?")&&(this.surveyDialog=!1,this.currentSurvey.questions=[],this.survey=void 0)},parseDocument:function(t){var e,s=this;(this.boardId=t.boardId,this.title=t.title,this.contents=JSON.parse(t.contents),this.attachFromServer=t.attach,console.log(t.attach),this.isAnonymous=t.isAnonymous,t.survey&&(this.survey=t.survey),Array.isArray(t.attach)&&(t.attach=t.attach.filter(function(t){return null!==t})),t.attach)&&(console.log(t.attach),this.contents.ops.forEach(function(r){r.insert.hasOwnProperty("image")&&(e=t.attach.find(function(t){return t.attach_name===r.insert.image}),console.log(e),e&&(e.insert=!0,r.insert.image=s.webUrl+"/"+e.attach_path))}),this.attachedFilenames=t.attach.filter(function(t){return!t.insert}).map(function(t){return t.attach_name}));this.$refs.editor.quill.setContents(this.contents)},attachButtonClick:function(){this.documentId?this.openFileDialog():this.$refs.pond.browse()},openFileDialog:function(){document.getElementById("file-upload").click()},onFileChange:function(){var t=y(i.a.mark(function t(e){var s,r,n;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.rawFileData||(this.rawFileData=new FormData),s=this,r=e.target.files||e.dataTransfer.files,!(r.length>0)){t.next=16;break}n=0;case 5:if(!(n<r.length)){t.next=16;break}if(!(r[n].size>8388608)){t.next=9;break}return this.$store.dispatch("showSnackbar",{text:"8MB 이하의 파일만 첨부가능합니다.",color:"error"}),t.abrupt("break",16);case 9:return t.next=11,s.rawFileData.append("file",r[n],r[n].name);case 11:return t.next=13,s.attachedFilenames.push(r[n].name);case 13:n++,t.next=5;break;case 16:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),removeFile:function(){var t=y(i.a.mark(function t(e){var s,r,n,a,o,c,l,u;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.rawFileData){t.next=33;break}s=new FormData,r=0,n=!0,a=!1,o=void 0,t.prev=6,c=this.rawFileData.entries()[Symbol.iterator]();case 8:if(n=(l=c.next()).done){t.next=18;break}if(u=l.value,"file"!==u[0]){t.next=15;break}if(r===Number(e)){t.next=14;break}return t.next=14,s.append(u[0],u[1],u[1].name);case 14:r+=1;case 15:n=!0,t.next=8;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](6),a=!0,o=t.t0;case 24:t.prev=24,t.prev=25,n||null==c.return||c.return();case 27:if(t.prev=27,!a){t.next=30;break}throw o;case 30:return t.finish(27);case 31:return t.finish(24);case 32:this.rawFileData=s;case 33:this.attachedFilenames.splice(e,1);case 34:case"end":return t.stop()}},t,this,[[6,20,24,32],[25,,27,31]])}));function e(e){return t.apply(this,arguments)}return e}(),processUploadFiles:function(){this.rawFileData||(this.rawFileData=new FormData);var t={},e=!0,s=!1,r=void 0;try{for(var n,a=this.rawFileData.entries()[Symbol.iterator]();!(e=(n=a.next()).done);e=!0){var i=n.value;t[i[1].name]={count:t[i[1].name]?t[i[1].name].count+1:1,index:0}}}catch(y){s=!0,r=y}finally{try{e||null==a.return||a.return()}finally{if(s)throw r}}var o=!0,c=!1,l=void 0;try{for(var u,h=this.rawFileData.entries()[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var v=u.value,d=v[1].name.lastIndexOf("."),f=v[1].name.substring(d,v[1].name.length),p=v[1].name.substring(0,d),m="";t[v[1].name].count>0&&(m=0===t[v[1].name].index?"":" (".concat(t[v[1].name].index,")"),t[v[1].name].index+=1),this.formData.append("attach",v[1],p+m+f)}}catch(y){c=!0,l=y}finally{try{o||null==h.return||h.return()}finally{if(c)throw l}}},selectImage:function(){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click();var e=this;t.onchange=function(){var s=t.files[0],r=new FileReader;r.readAsDataURL(s),r.onload=function(){if(/^image\//.test(s.type)){console.log("이미지다");var t=e.$refs.editor.quill.getSelection();console.log(t),console.log(s),e.$refs.editor.quill.insertEmbed(null==t?e.$refs.editor.quill.getLength():t.index,"image",r.result)}else this.$store.dispatch("showSnackbar",{text:"이미지 파일만 업로드할 수 있습니다.",color:"error"})},r.onerror=function(t){console.log("Error: ",t)}}}},computed:{editor:function(){return this.$refs.editor.quill}},watch:{isAnonymous:{handler:function(t){t&&(this.disallowAnonymous=!1)}}},created:function(){var t=this;this.boardId&&this.documentId&&this.$axios.get("/".concat(this.boardId,"/").concat(this.documentId)).then(function(e){t.parseDocument(e.data)}).catch(function(e){console.log(e),console.log(e.response),t.$store.dispatch("showSnackbar",{text:"게시물을 불러오는데 실패했습니다.",color:"error"}),t.$router.replace("/error?error="+(e&&e.response&&e.response.status||"404"))})}},b=g,w=(s("ace1"),Object(v["a"])(b,r,n,!1,null,null,null));e["default"]=w.exports}}]);
//# sourceMappingURL=chunk-5f6d7132.c620afc9.js.map