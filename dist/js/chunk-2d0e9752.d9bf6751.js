(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e9752"],{"8e2a":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-container",[a("v-layout",{attrs:{row:"","justify-center":"","align-center":""}},[a("v-flex",{staticClass:"mx-auto",attrs:{xs12:"",sm10:"",lg8:"","px-3":t.$vuetify.breakpoint.xsOnly}},[a("v-layout",{attrs:{row:"",wrap:""}},[a("v-flex",{attrs:{xs12:""}},[a("h3",{staticClass:"headline"},[t._v("채팅 목록")])]),a("v-flex",{attrs:{xs12:""}},[a("v-data-table",{class:{"customAction mt-4":!0,noResult:0===t.totalChats},attrs:{xs12:"",items:t.chats,id:"chatTable","hide-headers":"","rows-per-page-items":[15],loading:t.loading,"total-items":t.totalChats,pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"items",fn:function(e){return[a("tr",{staticClass:"cursor-pointer",on:{click:function(s){t.getChat(e.item)}}},[a("td",{staticClass:"px-2"},[a("v-avatar",{attrs:{color:"T"!==e.item.chatType?null:"primary",title:e.item.otherNickName+"님과의 대화",size:"32px"}},["T"!==e.item.chatType?a("img",{attrs:{src:e.item.picturePath||s("53c0")}}):a("span",{staticClass:"white--text subheading"},[t._v(t._s("(알 수 없음)"===e.item.otherNickName?"?":e.item.otherNickName.substring(0,1)))])])],1),t.$vuetify.breakpoint.smAndUp?a("td",{staticClass:"text-xs-left px-1",attrs:{title:"T"===e.item.chatType?"토픽 닉네임":"라운지 필명"}},[t._v(t._s(e.item.otherNickName))]):t._e(),a("td",{staticClass:"text-xs-left multi-row px-2"},[t._v(t._s(t.getShortContents(e.item.lastContents)))]),a("td",{staticClass:"text-xs-right px-2"},[t._v(t._s(e.item.lastSendTimestamp.fromNow()))]),a("td",{staticClass:"px-2"},[a("v-btn",{staticClass:"short",attrs:{small:"",color:"error"},on:{click:function(s){s.stopPropagation(),t.deleteChat(e.item)}}},[t._v("삭제")])],1)])]}}])},[a("template",{slot:"no-data"},[t._v(t._s(this.noresult))]),a("template",{slot:"actions-prepend"},[a("v-btn",{attrs:{color:"primary",loading:t.loading},on:{click:t.getChatList}},[t._v("새로고침")]),a("v-spacer")],1)],2)],1)],1)],1),a(t.$vuetify.breakpoint.xsOnly?"v-dialog":"div",{tag:"component",attrs:{"full-screen":""},model:{value:t.isChatOpen,callback:function(e){t.isChatOpen=e},expression:"isChatOpen"}},[a("beautiful-chat",{attrs:{participants:t.participants,onMessageWasSent:t.sendMessage,loadPreviousMessages:t.loadPreviousMessages,loadNewMessages:t.loadNewMessages,loading:t.loadingMessages,messageList:t.messageList,newMessagesCount:t.newMessagesCount,isOpen:t.isChatOpen,close:t.closeChat,open:t.openChat,placeholder:"대화 내용을 입력해주세요.",showEmoji:!1,"has-user-list":!1,showFile:!1,colors:t.colors,alwaysScrollToBottom:t.scrollToBottom,showLauncher:!1,messageStyling:!1,title:t.title,disabled:t.disabled}})],1)],1)],1)},n=[],o=s("713b");function i(t){return m(t)||c(t)||r()}function r(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function c(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}function m(t){if(Array.isArray(t)){for(var e=0,s=new Array(t.length);e<t.length;e++)s[e]=t[e];return s}}function h(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{},a=Object.keys(s);"function"===typeof Object.getOwnPropertySymbols&&(a=a.concat(Object.getOwnPropertySymbols(s).filter(function(t){return Object.getOwnPropertyDescriptor(s,t).enumerable}))),a.forEach(function(e){l(t,e,s[e])})}return t}function l(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var d={name:"Message",data:function(){return{loading:!0,chats:[],totalChats:0,pagination:{},participants:[{id:"other",name:"other",imageUrl:""}],messageList:[],newMessagesCount:0,isChatOpen:!1,colors:{header:{bg:"#4e8cff",text:"#ffffff"},launcher:{bg:"#4e8cff"},messageList:{bg:"#ffffff"},sentMessage:{bg:"#4e8cff",text:"#ffffff"},receivedMessage:{bg:"#eaeaea",text:"#222222"},userInput:{bg:"#f4f7f9",text:"#565867"}},title:"",disabled:!1,chatId:null,noPreviousMessage:!1,scrollToBottom:!0,loadingMessages:!1}},computed:{noresult:function(){return this.loading?"내 채팅 목록을 불러오고 있습니다. 잠시만 기다려주세요...":"아직 개설된 채팅이 없습니다."}},created:function(){this.$emit("update:layout",o["a"]),this.$store.dispatch("setColumnType","HIDE_ALWAYS"),this.getChatList()},mounted:function(){var t=this;this.$route.query.chatId&&(this.chats.some(function(e){return e.chatId===t.$route.query.chatId})?this.getChat(this.chats.find(function(e){return e.chatId===t.$route.query.chatId})):this.$axios.get("/message/target",{params:{chatId:this.$route.query.chatId},headers:{silent:!0}}).then(function(e){t.getChat(e.data)}).catch(function(e){t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"채팅을 찾지 못했습니다."),color:"error"})}))},methods:{getChatList:function(){var t=this;this.loading=!0,this.$axios.get("/message/list",{params:{page:this.pagination.page},headers:{silent:!0}}).then(function(e){t.chats=e.data.map(function(e){return h({},e,{lastSendTimestamp:t.$moment(e.lastSendTimestamp,"YYYYMMDDHHmmss")})}),t.totalChats=e.data.length>0?e.data[0].totalCount:0,t.loading=!1}).catch(function(e){console.log(e),t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"채팅 목록을 가져오지 못했습니다."),color:"error"}),t.loading=!1}),this.closeChat()},sendMessage:function(t){var e=this;(function(t){if(t.data.text.trim().length>0){t.data.text=t.data.text.trim();var s=e.chats.find(function(t){return t.chatId===e.chatId}),a=e.$moment(s.lastSendTimestamp).format("YMMDDHHmmss");e.$axios.post("/message",{chatId:e.chatId,contents:t.data.text,lastSendTimestamp:a},{headers:{silent:!0}}).then(function(t){Array.isArray(t.data.messageList)&&(t.data.messageList.reverse(),e.messageList=e.messageList.concat(t.data.messageList.filter(function(t){return t.sendTimestamp>a}).map(function(t){return{author:t.isSender?"me":s?s.otherNickName:"(알 수 없음)",type:"text",data:{text:t.contents,meta:e.$moment(t.sendTimestamp,"YYYYMMDDHHmmss").format("Y.M.D hh:mm:ss a")}}})),t.data.messageList.length>0&&(s.lastSendTimestamp=e.$moment(t.data.messageList[t.data.messageList.length-1].sendTimestamp,"YYYYMMDDHHmmss"),s.lastContents=t.data.messageList[t.data.messageList.length-1].contents))}).catch(function(t){console.log(t.response),e.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"메시지를 보내지 못했습니다."),color:"error"})})}})(t)},onMessageWasSent:function(t){this.messageList=[].concat(i(this.messageList),[t])},openChat:function(){this.isChatOpen=!0,this.newMessagesCount=0},closeChat:function(){this.isChatOpen=!1},getChat:function(t){var e=this;this.disabled="DELETED"===t.otherStatus,this.axios.get("/message",{params:{chatId:t.chatId}}).then(function(a){e.messageList=a.data.map(function(s){return{author:s.isSender?"me":t.otherNickName,type:"text",data:{text:s.contents,meta:e.$moment(s.sendTimestamp,"YYYYMMDDHHmmss").format("Y.M.D hh:mm:ss a")}}}),console.log(e.messageList,"messageList"),e.messageList.reverse(),e.disabled&&e.messageList.push({type:"system",data:{text:"".concat(t.otherNickName," 님이 채팅을 나갔습니다.")}}),e.noPreviousMessage=e.messageList.length<15,e.participants=[{id:t.otherNickName,name:t.otherNickName,imageUrl:"T"===t.chatType?"":t.picturePath||s("53c0")}],e.chatId=t.chatId,e.isChatOpen=!0}).catch(function(t){console.log(t.response),e.$store.dispatch("showSnackbar",{text:t.response?t.response.data.message:"채팅을 불러오지 못했습니다.",color:"error"})}),this.title=t.otherNickName+"님과의 대화"},deleteChat:function(t){var e=this;confirm("이 채팅을 삭제하면 대화 내용이 모두 사라집니다.\n정말 삭제하시겠어요?")&&(this.closeChat(),this.$axios.delete("/message/"+t.chatId).then(function(s){e.chats.splice(e.chats.findIndex(function(e){return e.chatId===t.chatId}),1),e.$store.dispatch("showSnackbar",{text:"채팅을 삭제하였습니다.",color:"success"})}).catch(function(t){console.log(t.response),e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"채팅을 삭제하지 못했습니다.",color:"error"})}))},loadPreviousMessages:function(){var t=this;(function(){t.noPreviousMessage||(t.scrollToBottom=!1,t.loadingMessages=!0,t.axios.get("/message",{params:{chatId:t.chatId,timestampBefore:t.messageList[0]?t.$moment(t.messageList[0].data.meta,"YYYY.M.D hh:mm:ss a").format("YMMDDHHmmss"):t.$moment().format("YMMDDHHmmss")},headers:{silent:!0}}).then(function(e){if(Array.isArray(e.data)){e.data.length<15&&(t.noPreviousMessage=!0),e.data.reverse();var s=t.chats.find(function(e){return e.chatId===t.chatId});t.messageList=e.data.map(function(e){return{author:e.isSender?"me":s.otherNickName,type:"text",data:{text:e.contents,meta:t.$moment(e.sendTimestamp,"YYYYMMDDHHmmss").format("Y.M.D hh:mm:ss a")}}}).concat(t.messageList),t.loadingMessages=!1,t.$nextTick(function(){t.scrollToBottom=!0})}}).catch(function(e){console.log(e.response),t.scrollToBottom=!0,t.loadingMessages=!1,t.$store.dispatch("showSnackbar",{text:e.response?e.response.data.message:"메시지를 불러오지 못했습니다.",color:"error"})}))})()},loadNewMessages:function(){var t=this;(function(){t.loadingMessages=!0;var e=t.messageList.length>0?t.$moment(t.messageList[t.messageList.length-1].data.meta,"YYYY.M.D hh:mm:ss a").format("YMMDDHHmmss"):void 0;t.axios.get("/message",{params:{chatId:t.chatId,timestampAfter:e},headers:{silent:!0}}).then(function(s){var a=t.chats.find(function(e){return e.chatId===t.chatId});s.data.reverse(),t.messageList=t.messageList.concat(s.data.filter(function(t){return!e||t.sendTimestamp>e}).map(function(e){return{author:e.isSender?"me":a.otherNickName,type:"text",data:{text:e.contents,meta:t.$moment(e.sendTimestamp,"YYYYMMDDHHmmss").format("Y.M.D hh:mm:ss a")}}})),t.loadingMessages=!1}).catch(function(e){console.log(e.response),t.loadingMessages=!1,t.$store.dispatch("showSnackbar",{text:e.response?e.response.data.message:"메시지를 불러오지 못했습니다.",color:"error"})})})()},getShortContents:function(t){return t&&t.length>50?t.substring(0,50)+"...":t}},watch:{pagination:{handler:function(){this.getChatList()},deep:!0},isChatOpen:function(t){this.$vuetify.breakpoint.xsOnly&&(document.body.style.position=t?"fixed":"initial")}}},u=d,g=s("0c7c"),p=Object(g["a"])(u,a,n,!1,null,null,null);e["default"]=p.exports}}]);
//# sourceMappingURL=chunk-2d0e9752.d9bf6751.js.map