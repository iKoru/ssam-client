(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d22db79"],{f94d:function(e,t,s){"use strict";s.r(t);var o=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("v-card",{attrs:{tile:""}},[s("v-toolbar",{attrs:{card:"",color:"white"}},[s("v-toolbar-title",[e._v(e._s(e.board?"토픽 관리":"새로운 토픽 만들기"))]),s("v-spacer"),s("v-toolbar-items",[s("v-btn",{attrs:{icon:""},on:{click:function(t){return e.$emit("closeDialog",null)}}},[s("v-icon",[e._v("close")])],1)],1)],1),s("v-card-text",[s("v-form",{ref:"form"},[s("v-layout",{attrs:{row:"",xs12:"",wrap:""}},[s("v-flex",{staticClass:"mb-1",attrs:{xs6:""}},[e.board?s("v-text-field",{staticClass:"dense",attrs:{readonly:"",label:"토픽ID",hint:"pedagy.com/<b>seoul</b>과 같이 URL주소에 들어가는 문구입니다."},model:{value:e.boardId,callback:function(t){e.boardId=t},expression:"boardId"}}):s("v-text-field",{staticClass:"dense",attrs:{rules:e.boardIdRules,"error-messages":e.boardIdErrors,maxlength:"15",label:"토픽ID",hint:"pedagy.com/<b>seoul</b>과 같이 URL주소에 들어갈 문구입니다.",placeholder:"비워두면 임의로 생성됩니다.","validate-on-blur":""},on:{blur:e.checkBoardId},model:{value:e.boardId,callback:function(t){e.boardId=t},expression:"boardId"}})],1),s("v-flex",{staticClass:"mb-1",attrs:{xs6:""}},[s("v-text-field",{staticClass:"dense",attrs:{rules:e.boardNameRules,maxlength:"200",label:"토픽 이름",required:"",hint:"토픽 목록에 표시되는 이름입니다.","validate-on-blur":""},model:{value:e.boardName,callback:function(t){e.boardName=t},expression:"boardName"}})],1),s("v-flex",{attrs:{xs12:""}},[s("v-textarea",{ref:"boardDescription",attrs:{rows:3,maxlength:"1000",height:"80px",label:"토픽 소개",hint:"토픽 이름 아래에 작게 표시되는 설명입니다.","validate-on-blur":""},model:{value:e.boardDescription,callback:function(t){e.boardDescription=t},expression:"boardDescription"}})],1),s("v-flex",{attrs:{xs6:""}},[s("v-checkbox",{ref:"allowAnonymous",staticClass:"dense mt-2",attrs:{label:"익명글 허용","hide-details":""},model:{value:e.allowAnonymous,callback:function(t){e.allowAnonymous=t},expression:"allowAnonymous"}})],1),s("v-flex",{attrs:{xs6:""}},[s("v-tooltip",{attrs:{bottom:""}},[s("v-checkbox",{ref:"useCategory",staticClass:"dense mt-2",attrs:{slot:"activator",label:"카테고리 분류 사용","hide-details":""},slot:"activator",model:{value:e.useCategory,callback:function(t){e.useCategory=t},expression:"useCategory"}}),s("span",[e._v("글을 작성할 때 작성자가 기본/정보/질문 중 하나의 카테고리를 지정할 수 있습니다.")])],1)],1),s("v-flex",{staticClass:"mt-3",attrs:{xs6:""}},[s("v-select",{attrs:{items:e.allGroupAuthItems,label:"토픽 공개 여부",dense:""},model:{value:e.allGroupAuth,callback:function(t){e.allGroupAuth=t},expression:"allGroupAuth"}})],1),s("v-flex",{staticClass:"mt-3",attrs:{xs6:""}},[s("v-layout",{attrs:{"align-center":"","fill-height":""}},[s(e.$vuetify.breakpoint.xsOnly?"small":"div",{tag:"component",domProps:{innerHTML:e._s(e.allGroupAuthDescription)}})],1)],1),s("v-flex",{attrs:{xs12:""}},[s(e.$vuetify.breakpoint.xsOnly?"v-select":"v-autocomplete",{tag:"component",attrs:{name:"allowedGroups",chips:"",multiple:"","item-text":"text",dense:"","item-value":"value",disabled:"READWRITE"===e.allGroupAuth,items:e.groupItems,label:"구독 권한",hint:"내가 구독할 수 있도록 선택해야 합니다."+(""!==e.myGroup?" 나의 구독가능 정보 : "+e.myGroup:""),"persistent-hint":"","menu-props":{closeOnContentClick:e.$vuetify.breakpoint.xsOnly}},scopedSlots:e._u([{key:"selection",fn:function(t){return[s("v-chip",{key:t.item.value,attrs:{close:"",small:"",selected:t.selected},on:{input:function(s){return e.removeChip(t,t.item,e.allowedGroups)}}},[e._v(e._s(t.item.text))])]}},{key:"item",fn:function(t){return[s("v-list-tile-content",[s("v-list-tile-title",{domProps:{innerHTML:e._s(t.item.text)}})],1)]}}]),model:{value:e.allowedGroups,callback:function(t){e.allowedGroups=t},expression:"allowedGroups"}})],1),e.board?s("v-flex",{staticClass:"mt-2",attrs:{xs12:""}},[s("v-select",{attrs:{name:"ownerNickName",dense:"",items:e.boardMemberItems,label:"토픽지기 양도",hint:"선택한 회원에게 토픽지기가 양도됩니다.","persistent-hint":""},model:{value:e.ownerNickName,callback:function(t){e.ownerNickName=t},expression:"ownerNickName"}})],1):e._e(),e.board&&e.board.reservedDate?s("v-flex",{staticClass:"mt-3",attrs:{xs12:""}},[s("v-textarea",{ref:"reservedContents",attrs:{rows:3,readonly:"",height:"80px",label:"변경 예약("+e.$moment(e.board.reservedDate,"YYYYMMDD").format("Y.M.D")+" 반영 예정) 내용",hint:"변경이 예약된 토픽의 내용입니다."},model:{value:e.reservedContents,callback:function(t){e.reservedContents=t},expression:"reservedContents"}})],1):e._e()],1),s("v-divider",{staticClass:"my-2"}),s("v-layout",{attrs:{row:""}},[s("v-btn",{attrs:{flat:""},on:{click:function(t){return e.reset(!0)}}},[e._v("초기화")]),e.board?s("v-btn",{attrs:{color:"error"},on:{click:e.deleteBoard}},[e._v("삭제")]):e._e(),s("v-spacer"),s("v-btn",{attrs:{color:"primary",loading:e.loading},on:{click:e.save}},[e._v("등록")])],1)],1)],1)],1)},r=[];const a=["document","documents","profile","profiles","auth","user","users","comment","comments","vote","votes","report","reports","index","scraps","scrap","board","boards","manage","manages","chat","chats","message","messages","group","groups","event","events","signup","signin","signout","resetPassword","notification","notifications","survey","list","admin","ADMIN","ADMINISTRATOR","administrator","attach","profiles","animal","loungeBest","topicBest","lounge","topic","type","best","sanction","userId","nickName","myPage","myBoard","myCommunity","pedagy","myPedagy","Pedagy"],i=[/^(?:[a-zA-Z]+)(?:[a-zA-Z0-9\-_]{0,15})$/,/^((?!(--|__)).)*$/],l={M:"전공",G:"학년",N:"일반",R:"지역",Z:"인증"};var n={name:"topicCreator",data(){return{loading:!1,boardId:null,boardName:null,boardDescription:null,allGroupAuth:"READONLY",allowAnonymous:!0,useCategory:!1,allowedGroups:[],allGroupAuthItems:[{value:"READWRITE",text:"전체구독허용"},{value:"READONLY",text:"읽기공개"},{value:"NONE",text:"비공개"}],ownerNickName:null,groupItems:[],boardIdRules:[e=>!a.includes(e)||"사용할 수 없는 ID입니다.",e=>!e||e.length>3&&e.length<16||"4~15자로 입력해주세요.",e=>i[0].test(e)||"토픽ID의 길이가 너무 길거나, 알파벳이 아닌 문자가 있습니다.",e=>i[1].test(e)||"토픽ID에 연속된 [_, -]가 있습니다."],boardNameRules:[e=>!!e||"토픽 이름을 입력해주세요."],boardMemberItems:[],boardIdErrors:[]}},props:["board"],computed:{myGroup(){const e=this.$store.getters.profile;return this.groupItems.filter(t=>e.groups.some(e=>e===t.value)).map(e=>e.text).join(", ")},allGroupAuthDescription(){switch(this.allGroupAuth){case"READONLY":return"구독자만 글을 쓸 수 있지만,<br>구독하지 않아도 글을 볼 수 있습니다.<br>그 대신 핫토픽에 글이 노출됩니다.";case"NONE":return"구독자만 글을 읽고 쓸 수 있습니다.<br>핫토픽에는 글이 노출되지 않습니다.";case"READWRITE":return"모든 회원이 토픽을 구독할 수 있습니다.<br>구독하지 않아도 글을 볼 수 있습니다.<br>핫토픽에 글이 노출됩니다."}},reservedContents(){if(this.board&&this.board.reservedContents){let e=this.board.reservedContents,t="";for(let s in e)switch(s){case"boardName":t+=`토픽 이름 : ${e[s]}\n`;break;case"boardDescription":t+=`토픽 설명 : ${e[s]}\n`;break;case"allowAnonymous":t+=`익명글 허용 여부 : ${e[s]?"허용":"비허용"}\n`;break;case"useCategory":t+=`카테고리 : ${e[s]?"사용":"미사용"}\n`;break;case"allGroupAuth":t+=`토픽 공개/비공개 : ${this.allGroupAuthItems.some(t=>t.value===e[s])?this.allGroupAuthItems.find(t=>t.value===e[s]).text:"(알 수 없음)"}\n`;break;case"ownerNickName":t+=`토픽지기 : ${e[s]}\n`;break;case"auth":t+=`구독 권한 : ${e[s].filter(e=>this.groupItems.some(t=>t.value===e.groupId)).map(e=>this.groupItems.find(t=>t.value===e.groupId).text+("INSERT"===e.command?" 추가":"DELETE"===e.command?" 삭제":"")).join(", ")}`;break;case"status":t+="DELETED"===e[s]?"토픽 삭제 예정":"";break}return t}return null}},methods:{reset(e){this.board?(e||(this.loading=!0,this.$axios.get("/board/member",{params:{boardId:this.board.boardId},headers:{silent:!0}}).then(e=>{const t=this.$store.getters.profile.topicNickName;this.boardMemberItems=e.data.filter(e=>e.nickName!==t).map(e=>e.nickName),this.loading=!1}).catch(e=>{console.log(e.response),this.loading=!1,this.$store.dispatch("showSnackbar",{text:e.response?e.response.data.message:"토픽 구성원을 불러오지 못했습니다.",color:"error"})})),this.boardId=this.board.boardId,this.boardName=this.board.boardName,this.boardDescription=this.board.boardDescription,this.allGroupAuth=this.board.allGroupAuth,this.allowAnonymous=this.board.allowAnonymous,this.useCategory=!!this.board.categories&&this.board.categories.filter(e=>e).length>0,this.allowedGroups=this.board.boardAuth.map(e=>e.groupId),this.ownerNickName=this.board.ownerNickName):(this.boardId=null,this.boardName=null,this.boardDescription=null,this.allGroupAuth="READONLY",this.allowAnonymous=!0,this.useCategory=!1,this.allowedGroups=[],this.ownerNickName=null)},removeChip(e,t,s){e.parent.selectedItems.splice(e.parent.selectedItems.indexOf(t.value),1),s.splice(s.indexOf(t.value),1)},checkBoardId(e){this.boardId&&0===this.boardIdErrors.length?this.$axios.get("/boardId",{params:{boardId:this.boardId},headers:{silent:!0}}).then(t=>{this.boardIdErrors=[],"function"===typeof e&&e.call(this)}).catch(t=>{this.boardIdErrors=[t&&t.response&&t.response.data.message],"function"===typeof e&&e.call(this)}):"function"===typeof e&&e.call(this)},save(){this.board?this.$refs.form.validate()&&0===this.boardIdErrors.length?confirm("변경 내용은 1개월 뒤에 반영됩니다. 계속하시겠습니까?")&&(this.loading=!0,this.$axios.put("/board",{boardId:this.boardId,boardName:this.boardName,boardDescription:this.boardDescription||void 0,allGroupAuth:this.allGroupAuth,allowAnonymous:this.allowAnonymous,allowedGroups:this.allowedGroups.map(e=>({groupId:e,authType:"READWRITE"})),useCategory:this.useCategory,ownerNickName:this.ownerNickName||void 0}).then(e=>{this.loading=!1,this.$emit("resetBoard"),this.$emit("closeDialog"),this.$store.dispatch("showSnackbar",{text:"토픽 정보를 변경 예약하였습니다.",color:"success"})}).catch(e=>{console.log(e.response),this.loading=!1,this.$store.dispatch("showSnackbar",{text:e.response?e.response.data.message:"토픽을 만들지 못했습니다.",color:"error"})})):this.$store.dispatch("showSnackbar",{text:"토픽 정보를 정확히 입력해주세요.",color:"error"}):this.checkBoardId(()=>{this.$refs.form.validate()&&0===this.boardIdErrors.length?(this.loading=!0,this.$axios.post("/board",{boardId:this.boardId,boardName:this.boardName,boardType:"T",boardDescription:this.boardDescription||void 0,allGroupAuth:this.allGroupAuth,allowAnonymous:this.allowAnonymous,allowedGroups:this.allowedGroups.map(e=>({groupId:e,authType:"READWRITE"})),useCategory:this.useCategory}).then(e=>{this.loading=!1,this.$store.dispatch("addBoard",{boardId:this.boardId,boardName:this.boardName,boardType:"T",boardDescription:this.boardDescription||void 0,allGroupAuth:this.allGroupAuth,allowAnonymous:this.allowAnonymous}),this.$store.dispatch("addUserBoard",{boardId:this.boardId,boardName:this.boardName,boardType:"T",boardDescription:this.boardDescription||void 0,allGroupAuth:this.allGroupAuth,allowAnonymous:this.allowAnonymous}),this.$emit("resetBoard"),this.$emit("closeDialog"),this.reset(),this.$store.dispatch("showSnackbar",{text:"새로운 토픽을 만들었습니다.",color:"success"})}).catch(e=>{console.log(e.response),this.loading=!1,this.$store.dispatch("showSnackbar",{text:e.response?e.response.data.message:"토픽을 만들지 못했습니다.",color:"error"})})):this.$store.dispatch("showSnackbar",{text:"토픽 정보를 정확히 입력해주세요.",color:"error"})})},deleteBoard(){confirm("토픽 삭제는 1개월 유예기간 후에 이루어지고,\n삭제 후에는 모든 글에 접근이 불가능합니다. 계속하시겠습니까?")&&this.$axios.put("/board",{boardId:this.boardId,status:"DELETED"}).then(e=>{this.$emit("resetBoard"),this.$emit("closeDialog"),this.$store.dispatch("showSnackbar",{text:"토픽 삭제를 예약하였습니다.",color:"success"})}).catch(e=>{console.log(e.response),this.$store.dispatch("showSnackbar",{text:e.response?e.response.data.message:"토픽을 만들지 못했습니다.",color:"error"})})}},created(){this.$store.getters.groups?this.groupItems=this.$store.getters.groups:this.$axios.get("/group",{headers:{silent:!0}}).then(e=>{e.data.forEach(e=>{"N"!==e.groupType&&"D"!==e.groupType&&"E"!==e.groupType||(e.groupType="Z")}),this.groupItems=e.data.sort((e,t)=>e.groupType<t.groupType?-1:e.groupType===t.groupType?0:1);let t=null,s=0;while(s<this.groupItems.length)t!==this.groupItems[s].groupType&&(t?(t=this.groupItems[s].groupType,this.groupItems.splice(s,0,{divider:!0}),s++):t=this.groupItems[s].groupType,this.groupItems.splice(s,0,{header:l[t]}),s++),s++;this.groupItems=this.groupItems.map(e=>e.groupName?{text:e.groupName,value:e.groupId}:e),this.$store.dispatch("setGroups",this.groupItems)}).catch(e=>{this.$store.dispatch("showSnackbar",{text:`그룹 목록을 가져오지 못했습니다.${e&&e.response&&e.response.data?"["+e.response.data.message+"]":""}`})}),this.reset()},watch:{boardId(){this.boardIdErrors.length>0&&(this.boardIdErrors=[])},board:{handler(){this.reset()},deep:!0}}},d=n,u=s("0c7c"),c=Object(u["a"])(d,o,r,!1,null,null,null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d22db79.f2a6118d.js.map