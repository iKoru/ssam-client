(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58c0f438"],{2558:function(t,e,n){},3962:function(t,e,n){},"437a":function(t,e,n){"use strict";var o=n("2558"),s=n.n(o);s.a},"4bc5":function(t,e,n){},5185:function(t,e,n){"use strict";var o=n("8d4f"),s=n.n(o);s.a},5347:function(t,e,n){"use strict";var o=n("c1df"),s=n.n(o),r={data:function(){return{boardTypeItems:{T:"토픽",L:"라운지",D:"아카이브",X:"게시판",E:"전직교사",N:"예비교사"},webUrl:"https://pedagy.com"}},methods:{uuid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var n=t.split(",")[0].split(":")[1].split(";")[0],o=new Uint8Array(e.length),s=0;s<e.length;s++)o[s]=e.charCodeAt(s);return new Blob([o],{type:n})},timeParser:function(t){return s()(t,"YYYYMMDDHHmmss").fromNow()}}};e["a"]=r},"53c0":function(t,e,n){t.exports=n.p+"img/defaultUser.8cc93c28.png"},"5ae1":function(t,e,n){},8512:function(t,e,n){(function(t){function e(t){return e="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"===typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},e(t)}(function(){var n;function o(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}var s="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},r="undefined"!=typeof window&&window===this?this:"undefined"!=typeof t&&null!=t?t:this;function a(){a=function(){},r.Symbol||(r.Symbol=c)}var i,c=function(){var t=0;return function(e){return"jscomp_symbol_"+(e||"")+t++}}();function u(){a();var t=r.Symbol.iterator;t||(t=r.Symbol.iterator=r.Symbol("iterator")),"function"!=typeof Array.prototype[t]&&s(Array.prototype,t,{configurable:!0,writable:!0,value:function(){return l(o(this))}}),u=function(){}}function l(t){return u(),t={next:t},t[r.Symbol.iterator]=function(){return this},t}function m(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:o(t)}}if("function"==typeof Object.setPrototypeOf)i=Object.setPrototypeOf;else{var d;t:{var p={o:!0},h={};try{h.__proto__=p,d=h.o;break t}catch(j){}d=!1}i=d?function(t,e){if(t.__proto__=e,t.__proto__!==e)throw new TypeError(t+" is not extensible");return t}:null}var f=i;function v(){this.g=!1,this.c=null,this.m=void 0,this.b=1,this.l=this.s=0,this.f=null}function y(t){if(t.g)throw new TypeError("Generator is already running");t.g=!0}function b(t,e,n){return t.b=n,{value:e}}function g(t){for(var e in this.w=t,this.j=[],t)this.j.push(e);this.j.reverse()}function x(t){this.a=new v,this.A=t}function w(t,e){y(t.a);var n=t.a.c;return n?C(t,"return"in n?n["return"]:function(t){return{value:t,done:!0}},e,t.a["return"]):(t.a["return"](e),I(t))}function C(t,e,n,o){try{var s=e.call(t.a.c,n);if(!(s instanceof Object))throw new TypeError("Iterator result "+s+" is not an object");if(!s.done)return t.a.g=!1,s;var r=s.value}catch(a){return t.a.c=null,t.a.i(a),I(t)}return t.a.c=null,o.call(t.a,r),I(t)}function I(t){for(;t.a.b;)try{var e=t.A(t.a);if(e)return t.a.g=!1,{value:e.value,done:!1}}catch(n){t.a.m=void 0,t.a.i(n)}if(t.a.g=!1,t.a.f){if(e=t.a.f,t.a.f=null,e.v)throw e.u;return{value:e["return"],done:!0}}return{value:void 0,done:!0}}function _(t){this.next=function(e){return t.h(e)},this["throw"]=function(e){return t.i(e)},this["return"]=function(e){return w(t,e)},u(),this[Symbol.iterator]=function(){return this}}function k(t,e){var n=new _(new x(e));return f&&f(n,t.prototype),n}if(v.prototype.h=function(t){this.m=t},v.prototype.i=function(t){this.f={u:t,v:!0},this.b=this.s||this.l},v.prototype["return"]=function(t){this.f={return:t},this.b=this.l},x.prototype.h=function(t){return y(this.a),this.a.c?C(this,this.a.c.next,t,this.a.h):(this.a.h(t),I(this))},x.prototype.i=function(t){return y(this.a),this.a.c?C(this,this.a.c["throw"],t,this.a.h):(this.a.i(t),I(this))},"undefined"===typeof FormData||!FormData.prototype.keys){var $=function(t,e){for(var n=0;n<t.length;n++)e(t[n])},A=function(t){return"string"===typeof t&&(t=t.replace(/\r\n/g,"\n").replace(/\n/g,"\r\n")),t},T=function(t,e,n){if(2>arguments.length)throw new TypeError("2 arguments required, but only "+arguments.length+" present.");return e instanceof Blob?[t+"",e,void 0!==n?n+"":"string"===typeof e.name?e.name:"blob"]:[t+"",e+""]},S=function(t){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");return[t+""]},E=function(t){var e=m(t);return t=e.next().value,e=e.next().value,t instanceof Blob&&(t=new File([t],e,{type:t.type,lastModified:t.lastModified})),t},D="object"===("undefined"===typeof window?"undefined":e(window))?window:"object"===("undefined"===typeof self?"undefined":e(self))?self:this,L=D.FormData,N=D.XMLHttpRequest&&D.XMLHttpRequest.prototype.send,M=D.Request&&D.fetch;a();var R=D.Symbol&&Symbol.toStringTag,W=new WeakMap,B=Array.from||function(t){return[].slice.call(t)};R&&(Blob.prototype[R]||(Blob.prototype[R]="Blob"),"File"in D&&!File.prototype[R]&&(File.prototype[R]="File"));try{new File([],"")}catch(j){D.File=function(t,e,n){return t=new Blob(t,n),n=n&&void 0!==n.lastModified?new Date(n.lastModified):new Date,Object.defineProperties(t,{name:{value:e},lastModifiedDate:{value:n},lastModified:{value:+n},toString:{value:function(){return"[object File]"}}}),R&&Object.defineProperty(t,R,{value:"File"}),t}}a(),u();var U=function(t){if(W.set(this,Object.create(null)),!t)return this;var e=this;$(t.elements,function(t){if(t.name&&!t.disabled&&"submit"!==t.type&&"button"!==t.type)if("file"===t.type)$(t.files||[],function(n){e.append(t.name,n)});else if("select-multiple"===t.type||"select-one"===t.type)$(t.options,function(n){!n.disabled&&n.selected&&e.append(t.name,n.value)});else if("checkbox"===t.type||"radio"===t.type)t.checked&&e.append(t.name,t.value);else{var n="textarea"===t.type?A(t.value):t.value;e.append(t.name,n)}})};if(n=U.prototype,n.append=function(t,e,n){var o=W.get(this);o[t]||(o[t]=[]),o[t].push([e,n])},n["delete"]=function(t){delete W.get(this)[t]},n.entries=function t(){var e,n,o,s,r,a,i=this;return k(t,function(t){switch(t.b){case 1:e=W.get(i),o=new g(e);case 2:var c;t:{for(c=o;0<c.j.length;){var u=c.j.pop();if(u in c.w){c=u;break t}}c=null}if(null==(n=c)){t.b=0;break}s=m(e[n]),r=s.next();case 5:if(r.done){t.b=2;break}return a=r.value,b(t,[n,E(a)],6);case 6:r=s.next(),t.b=5}})},n.forEach=function(t,e){for(var n=m(this),o=n.next();!o.done;o=n.next()){var s=m(o.value);o=s.next().value,s=s.next().value,t.call(e,s,o,this)}},n.get=function(t){var e=W.get(this);return e[t]?E(e[t][0]):null},n.getAll=function(t){return(W.get(this)[t]||[]).map(E)},n.has=function(t){return t in W.get(this)},n.keys=function t(){var e,n,o,s,r,a=this;return k(t,function(t){if(1==t.b&&(e=m(a),n=e.next()),3!=t.b)return n.done?void(t.b=0):(o=n.value,s=m(o),r=s.next().value,b(t,r,3));n=e.next(),t.b=2})},n.set=function(t,e,n){W.get(this)[t]=[[e,n]]},n.values=function t(){var e,n,o,s,r,a=this;return k(t,function(t){if(1==t.b&&(e=m(a),n=e.next()),3!=t.b)return n.done?void(t.b=0):(o=n.value,s=m(o),s.next(),r=s.next().value,b(t,r,3));n=e.next(),t.b=2})},U.prototype._asNative=function(){for(var t=new L,e=m(this),n=e.next();!n.done;n=e.next()){var o=m(n.value);n=o.next().value,o=o.next().value,t.append(n,o)}return t},U.prototype._blob=function(){for(var t="----formdata-polyfill-"+Math.random(),e=[],n=m(this),o=n.next();!o.done;o=n.next()){var s=m(o.value);o=s.next().value,s=s.next().value,e.push("--"+t+"\r\n"),s instanceof Blob?e.push('Content-Disposition: form-data; name="'+o+'"; filename="'+s.name+'"\r\n',"Content-Type: "+(s.type||"application/octet-stream")+"\r\n\r\n",s,"\r\n"):e.push('Content-Disposition: form-data; name="'+o+'"\r\n\r\n'+s+"\r\n")}return e.push("--"+t+"--"),new Blob(e,{type:"multipart/form-data; boundary="+t})},U.prototype[Symbol.iterator]=function(){return this.entries()},U.prototype.toString=function(){return"[object FormData]"},R&&(U.prototype[R]="FormData"),[["append",T],["delete",S],["get",S],["getAll",S],["has",S],["set",T]].forEach(function(t){var e=U.prototype[t[0]];U.prototype[t[0]]=function(){return e.apply(this,t[1].apply(this,B(arguments)))}}),N&&(XMLHttpRequest.prototype.send=function(t){t instanceof U?(t=t._blob(),this.setRequestHeader("Content-Type",t.type),N.call(this,t)):N.call(this,t)}),M){var O=D.fetch;D.fetch=function(t,e){return e&&e.body&&e.body instanceof U&&(e.body=e.body._blob()),O(t,e)}}D.FormData=U}})()}).call(this,n("c8ba"))},"88dd":function(t,e,n){"use strict";var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.survey?n("v-layout",{staticClass:"border-light py-2",attrs:{column:""}},[n("v-flex",[n("v-layout",{attrs:{row:"","align-center":"","mx-2":""}},[t.onlyView?n("span",{staticClass:"subheading"},[t._v("글 작성 후에 수정/삭제가 불가능합니다.")]):n("span",{staticClass:"subheading"},[t._v("설문조사")]),n("v-spacer"),n("span",{directives:[{name:"show",rawName:"v-show",value:t.finalResults,expression:"finalResults"}],staticStyle:{"white-space":"nowrap"}},[t._v("\n        "+t._s(t.survey.participants)+"명 참여\n      ")])],1)],1),t._l(t.survey.surveyContents.questions,function(e,o){return n("v-flex",{key:o,staticClass:"px-3 pt-2"},[n("div",{attrs:{id:"poll"}},[n("div",{staticClass:"font-weight-bold body-2 mb-2"},[t._v(t._s(o+1+". "+e.title)),e.allowMultipleChoice?n("small",{staticClass:"grey--text lighten-1"},[t._v("(복수응답)")]):t._e()]),n("div",{staticClass:"ans-cnt"},t._l(e.choices,function(s,r){return n("div",{key:r,staticClass:"ans"},[t.finalResults?[n("div",{class:{"ans-voted final multi-row":!0,selected:s.selected,"font-weight-bold":e.mostVotes==s.votes}},[s.percent?n("span",{staticClass:"percent"},[t._v(t._s(s.percent))]):t._e(),n("span",{staticClass:"txt"},[t._v(t._s(s.text))])]),n("span",{staticClass:"bg",style:{width:s.percent}})]:[n("div",{class:{"ans-no-vote multi-row":!0,active:s.selected},on:{click:function(e){return t.handleVote(o,s)}}},[n("span",{staticClass:"txt"},[t._v(t._s(s.text))])]),n("span",{staticClass:"bg"})]],2)}),0)]),o+1!==t.survey.surveyContents.questions.length?n("v-divider",{key:"divider"+o,staticClass:"mt-3"}):t._e()],1)}),t.survey.participated||t.onlyView?t._e():n("v-flex",[n("v-layout",{attrs:{"justify-center":"","my-2":""}},[n("v-btn",{attrs:{small:""},on:{click:function(e){t.showSurveyResult=!t.showSurveyResult}}},[t._v("\n        "+t._s(t.showSurveyResult?"돌아가기":"결과보기")+"\n      ")]),n("v-btn",{attrs:{small:"",color:"primary",disabled:t.finalResults},on:{click:t.completeSurvey}},[t._v("응답하기")])],1)],1)],2):t._e()},s=[],r={props:["currentSurvey","onlyView"],data:function(){return{showSurveyResult:!1,survey:null}},created:function(){this.survey=this.formatSurvey(this.currentSurvey)},computed:{finalResults:function(){return this.survey.participated||this.showSurveyResult}},methods:{formatSurvey:function(t){var e=t.surveyAnswers;return t.surveyContents.questions.forEach(function(t,n){var o=[],s=0,r=0;t.choices.forEach(function(t,a){e.length>n?(o.push({text:t,selected:!1,votes:e[n][a]}),e[n][a]>s&&(s=e[n][a]),r+=e[n][a]):o.push({text:t,selected:!1,votes:0})}),t.mostVotes=s,t.totalVotes=r,0===r?o.forEach(function(t){t.percent="0%"}):o.forEach(function(t){t.percent=!isNaN(t.votes)&&t.votes>0?Math.round(parseInt(t.votes)/r*100)+"%":"0%"}),t.choices=o}),t},getAnswerArray:function(t){var e=[];return t.forEach(function(t){if(t.allowMultipleChoice){var n=[];t.choices.forEach(function(t,e){t.selected&&n.push(e)}),e.push(n)}else e.push(t.choices.findIndex(function(t){return t.selected}))}),e},completeSurvey:function(){var t=this;if(this.survey.surveyContents.questions.every(function(t){return t.choices.some(function(t){return t.selected})})){if(this.survey.participated)return void this.$store.dispatch("showSnackbar",{text:"이미 참여한 설문입니다.",color:"info"});var e=this.getAnswerArray(this.survey.surveyContents.questions);this.$axios.post("/survey",{documentId:this.$route.params.documentId,answer:e}).then(function(e){console.log(e),e.data.survey?(t.survey=t.formatSurvey(e.data.survey),t.showSurveyResult=!0):t.$axios.get("/".concat(t.$route.params.boardId,"/").concat(t.$route.params.documentId)).then(function(e){t.survey=t.formatSurvey(e.data.survey),console.log(t.survey),t.showSurveyResult=!0}).catch(function(t){console.log(t)})}).catch(function(e){e.response&&409===e.response.status?t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"info"}):t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"error"})})}else this.$store.dispatch("showSnackbar",{text:this.survey.surveyContents.questions.findIndex(function(t){return!t.choices.some(function(t){return t.selected})})+1+"번 질문의 응답을 선택해주세요.",color:"warning"})},handleVote:function(t,e){this.survey.surveyContents.questions[t].allowMultipleChoice||e.selected||this.survey.surveyContents.questions[t].choices.forEach(function(t){return t.selected=!1}),e.selected=!e.selected}}},a=r,i=(n("437a"),n("0c7c")),c=Object(i["a"])(a,o,s,!1,null,null,null);e["a"]=c.exports},"8a1f":function(t,e,n){"use strict";var o=n("5ae1"),s=n.n(o);s.a},"8aeb":function(t,e,n){"use strict";var o=n("3962"),s=n.n(o);s.a},"8d4f":function(t,e,n){},bd5c:function(t,e,n){"use strict";n.r(e);var o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.document?n("v-layout",{attrs:{column:""}},[n("v-flex",[n("v-card-title",{attrs:{"primary-title":""}},[n("div",{staticClass:"w-100"},[n("router-link",{staticClass:"title mb-0 multi-row",attrs:{to:"/"+t.document.boardId+"/"+t.documentId}},[t._v(t._s(t.document.title))]),n("v-layout",{attrs:{row:"","mt-1":""}},[n("v-spacer"),n("v-flex",{attrs:{"text-xs-right":""}},[n("user-link",{attrs:{nickName:t.document.nickName,boardType:t.board.boardType}}),t._v("\n            | 댓글 "+t._s(t.document.commentCount)+" | 조회 "+t._s(t.document.viewCount)+" | "+t._s(t.$moment(t.document.writeDateTime,"YYYYMMDDHHmmss").format("Y.MM.DD HH:mm:ss"))+"\n          ")],1)],1)],1)])],1),n("v-divider"),n("v-flex",{attrs:{xs12:""}},[n("v-card-text",{staticClass:"px-0"},[n("div",{staticClass:"ql-editor py-0 px-3",attrs:{id:"documentContents"},domProps:{innerHTML:t._s(t.documentHTML)}})])],1),t.document.hasSurvey&&t.document.survey?n("v-layout",{attrs:{row:"","justify-center":""}},[n("v-flex",{attrs:{xs12:"",sm10:"",md8:"","mx-3":""}},[n("survey",{attrs:{currentSurvey:t.document.survey}})],1)],1):t._e(),n("v-flex",{attrs:{"text-xs-center":"","my-2":""}},[n("v-btn",{staticClass:"font-weight-bold short",on:{click:t.voteDocument}},[n("v-icon",{attrs:{color:"primary",small:""}},[t._v("thumb_up")]),t._v(" \n      "),n("span",[t._v(t._s(t.document.voteUpCount))])],1)],1),n("v-divider"),n("v-flex",{staticClass:"my-2"},[n("v-layout",{attrs:{row:""}},[t.board.isOwner?n("v-flex",[t.board.notices.some(function(e){return e.documentId===t.document.documentId})?n("v-btn",{staticClass:"my-0 px-2 short",on:{click:function(e){return t.setNotice(!1)}}},[t._v("공지해제")]):n("v-btn",{staticClass:"my-0 px-2 short",on:{click:function(e){return t.setNotice(!0)}}},[t._v("공지지정")])],1):t._e(),n("v-spacer"),n("v-flex",{attrs:{"pr-2":"","text-xs-right":""}},[n("v-btn-toggle",{attrs:{id:"bottomBottons"}},[t.document.attach&&t.document.attach.some(function(t){return!t.insert})?[n("v-btn",{class:{"primary--text":t.showAttach},attrs:{title:"첨부파일 보기"},on:{click:function(e){t.showAttach=!t.showAttach}}},[t._v("첨부파일("+t._s(t.document.attach.filter(function(t){return!t.insert}).length)+")")])]:t._e(),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.document.isWriter,expression:"document.isWriter"}],staticClass:"short",attrs:{to:"/"+t.$route.params.boardId+"/"+t.document.documentId+"/edit"}},[n("span",[t._v("수정")])]),n("v-btn",{directives:[{name:"show",rawName:"v-show",value:t.document.isWriter,expression:"document.isWriter"}],staticClass:"short",on:{click:t.deleteDocument}},[t._v("삭제")]),n(t.$vuetify.breakpoint.xsOnly?"v-bottom-sheet":"v-menu",{tag:"component",attrs:{"open-on-hover":"",bottom:"",lazy:"","offset-y":""},model:{value:t.scrapMenu,callback:function(e){t.scrapMenu=e},expression:"scrapMenu"}},[n("v-btn",{staticClass:"short",attrs:{slot:"activator"},slot:"activator"},[t._v("스크랩")]),n("v-list",{attrs:{dense:""}},[n("div",{staticClass:"v-list__tile font-weight-bold",on:{click:function(t){t.stopPropagation()}}},[t._v("스크랩 그룹 선택")]),t._l(t.scrapGroups,function(e){return n("v-list-tile",{key:e.scrapGroupId,on:{click:function(n){return t.scrapDocument(e)}}},[n("v-list-tile-title",[t._v(t._s(e.scrapGroupName))])],1)})],2)],1),n(t.$vuetify.breakpoint.xsOnly?"v-bottom-sheet":"v-menu",{tag:"component",attrs:{"open-on-hover":"",bottom:"",lazy:"","offset-y":""},model:{value:t.reportMenu,callback:function(e){t.reportMenu=e},expression:"reportMenu"}},[n("v-btn",{directives:[{name:"show",rawName:"v-show",value:!t.document.isWriter,expression:"!document.isWriter"}],staticClass:"short",attrs:{slot:"activator"},slot:"activator"},[t._v("신고")]),n("v-list",{attrs:{"two-line":""}},[n("div",{staticClass:"font-weight-bold mx-3 my-2",on:{click:function(t){t.stopPropagation()}}},[t._v("신고사유 선택")]),t._l(t.reportTypes,function(e){return n("v-list-tile",{key:e.reportTypeId,on:{click:function(n){return t.reportDocument(e)}}},[n("v-list-tile-content",[n("v-list-tile-title",[t._v(t._s(e.reportTypeName))]),n("v-list-tile-sub-title",[t._v(t._s(e.reportTypeDescription))])],1)],1)})],2)],1)],2)],1)],1),n("v-slide-y-transition",[n("v-layout",{attrs:{column:""}},[n("v-layout",{directives:[{name:"show",rawName:"v-show",value:t.showAttach,expression:"showAttach"}],attrs:{row:"","mt-1":"",wrap:""}},t._l(t.document.attach.filter(function(t){return!t.insert}),function(e,o){return n("v-flex",{key:o,attrs:{"px-2":"",xs6:"",md4:"",xl2:"","my-1":""}},[n("router-link",{staticClass:"ellipsis underline d-block",attrs:{to:t.webUrl+e.attach_path,target:"_blank",download:e.attach_name}},[t._v(t._s(e.attach_name))])],1)}),1),n("v-divider",{directives:[{name:"show",rawName:"v-show",value:t.showAttach,expression:"showAttach"}],staticClass:"my-2"})],1)],1)],1),n("v-flex",{attrs:{"mb-4":""}},[n("ViewComments",{attrs:{isAnonymous:t.document.isWriter&&""===t.document.nickName,allowAnonymous:t.document.allowAnonymous,isCommentWritable:t.isCommentWritable,reportTypes:t.reportTypes,boardId:t.document.boardId,best:t.document.bestComments,pages:t.pages}})],1)],1):t._e()},s=[],r=n("88dd"),a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{column:""}},[n("v-flex",{staticClass:"comment-editor px-3"},[n("quill-editor",{ref:"commentEditor",attrs:{options:t.editorOption}})],1),n("v-flex",{staticClass:"comment-writer-actions"},[n("v-layout",{attrs:{row:"","align-center":"","py-2":"","pr-2":"","justify-end":t.$vuetify.breakpoint.xsOnly}},[n("span",{directives:[{name:"show",rawName:"v-show",value:t.allowAnonymous,expression:"allowAnonymous"}],staticClass:"ml-3"},[n("v-checkbox",{staticClass:"pt-0 mt-0 small",attrs:{"hide-details":"",label:"익명",readonly:!!t.defaultComment,disabled:"AVAILABLE"!==t.isCommentWritable&&"NEEDSUBSCRIPTION"!==t.isCommentWritable},model:{value:t.anonymous,callback:function(e){t.anonymous=e},expression:"anonymous"}})],1),n("v-btn",{class:{"my-0":!0,"ml-0":!t.allowAnonymous},attrs:{small:"",flat:"",icon:t.$vuetify.breakpoint.xsOnly,disabled:"AVAILABLE"!==t.isCommentWritable&&"NEEDSUBSCRIPTION"!==t.isCommentWritable},on:{click:t.selectImage}},[n("v-icon",[t._v("image")]),t.$vuetify.breakpoint.smAndUp?n("span",{staticClass:"ml-2"},[t._v("이미지")]):t._e()],1),n("v-spacer"),t.defaultComment?n("v-btn",{staticClass:"short ma-0",attrs:{small:"",depressed:""},on:{click:function(e){return t.$emit("revokeUpdate")}}},[t._v("취소")]):t._e(),n("v-btn",{staticClass:"short my-0",attrs:{small:"",depressed:"",color:"primary",disabled:"AVAILABLE"!==t.isCommentWritable&&"NEEDSUBSCRIPTION"!==t.isCommentWritable,loading:t.loading},on:{click:t.postComment}},[t._v(t._s(t.defaultComment?"수정":"등록"))])],1)],1)],1)},i=[],c=n("a34a"),u=n.n(c),l=n("5347");n("8512");function m(t,e,n,o,s,r,a){try{var i=t[r](a),c=i.value}catch(u){return void n(u)}i.done?e(c):Promise.resolve(c).then(o,s)}function d(t){return function(){var e=this,n=arguments;return new Promise(function(o,s){var r=t.apply(e,n);function a(t){m(r,o,s,a,i,"next",t)}function i(t){m(r,o,s,a,i,"throw",t)}a(void 0)})}}var p={name:"WriteComment",mixins:[l["a"]],props:["commentTo","isAnonymous","allowAnonymous","isCommentWritable","boardId","defaultComment","focus"],data:function(){return{editorOption:{placeholder:"AVAILABLE"===this.isCommentWritable?"댓글을 입력해주세요.":"UNAVAILABLE"===this.isCommentWritable?"댓글을 작성할 수 있는 권한이 없습니다.":"RESTRICTED"===this.isCommentWritable?"글쓰기가 제한되어 있습니다.":"DELETED"===this.isCommentWritable?"삭제된 글입니다.":"토픽 구독 후 입력된 댓글이 등록됩니다.",modules:{magicUrl:{urlRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,globalRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,normalizeRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/},toolbar:void 0,imageDrop:!0},formData:void 0,theme:"bubble",spellCheck:!1},anonymous:this.isAnonymous||!0,newlyAddedImages:[],loading:!1}},components:{},mounted:function(){var t=this;if(this.defaultComment){var e=JSON.parse(this.defaultComment.contents);this.defaultComment.attach&&this.defaultComment.attach.some(function(t){return t})&&e.ops.filter(function(e){return e.insert.image&&t.defaultComment.attach.some(function(t){return t&&t.attach_name===e.insert.image})}).forEach(function(e){e.insert.image=t.webUrl+t.defaultComment.attach.find(function(t){return t&&t.attach_name===e.insert.image}).attach_path}),this.$refs.commentEditor.quill.setContents(e)}if(this.focus)try{this.$refs.commentEditor.quill.setSelection(this.$refs.commentEditor.quill.getLength())}catch(n){}},methods:{selectImage:function(){var t=d(u.a.mark(function t(){var e,n=this;return u.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:e=document.getElementById("commentFile"),e||(e=document.createElement("input"),e.setAttribute("id","commentFile"),e.setAttribute("type","file"),e.setAttribute("multiple","multiple"),e.setAttribute("accept","image/*"),e.classList.add("d-none"),document.body.appendChild(e)),e.onchange=d(u.a.mark(function t(){var o,s,r,a;return u.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:o=new FileReader,s=n.$refs.commentEditor.quill,o.onerror=function(t){console.log(t),this.$store.dispatch("showSnackbar",{text:"파일을 업로드하지 못했습니다.",color:"error"})},r=u.a.mark(function t(o){return u.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!e.files[o].type.startsWith("image/")){t.next=9;break}if(!(e.files[o].size>8388608)){t.next=5;break}n.$store.dispatch("showSnackbar",{text:"최대 8MB 이하의 이미지만 업로드할 수 있습니다.",color:"error"}),t.next=7;break;case 5:return t.next=7,new Promise(function(t){n.$loadImage(e.files[o],function(r){"error"===r.type&&n.$store.dispatch("showSnackbar",{text:"이미지를 업로드하지 못했습니다.",color:"error"});var a=s.getSelection();if(a)s.getLine(a.index)[1]&&(s.insertText(a.index,"\n"),a.index++),s.insertEmbed(a.index,"image",r.toDataURL(e.files[o].type,"image/jpeg"===e.files[o].type||"image/webp"===e.files[o].type?.91:void 0)),s.insertText(++a.index,"\n"),s.setSelection(++a.index);else{var i=s.getLength();s.getLine(i)[1]&&(s.insertText(i,"\n"),i++),s.insertEmbed(i,"image",r.toDataURL(e.files[o].type,"image/jpeg"===e.files[o].type||"image/webp"===e.files[o].type?.91:void 0)),s.insertText(++i,"\n"),s.setSelection(++i)}t()},{canvas:!0,orientation:!0,meta:!0})});case 7:t.next=10;break;case 9:n.$store.dispatch("showSnackbar",{text:"이미지 파일만 업로드할 수 있습니다.",color:"error"});case 10:case"end":return t.stop()}},t,this)}),a=0;case 5:if(!(a<e.files.length)){t.next=10;break}return t.delegateYield(r(a),"t0",7);case 7:a++,t.next=5;break;case 10:try{e.value=""}catch(i){e.parentNode.removeChild(e)}case 11:case"end":return t.stop()}},t,this)})),e.click();case 4:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),attachImages:function(){var t=this;this.$refs.commentEditor.quill.editor.delta.ops.forEach(function(e){if(e.insert.image&&e.insert.image.startsWith("data:image")){var n=e.insert.image,o=t.uuid()+"."+n.substring("data:image/".length,n.indexOf(";base64"));t.formData.append("attach",t.dataURItoBlob(n),o),e.insert.image=o,t.newlyAddedImages.push({base64:n,attach_name:o})}})},restoreServerImages:function(){var t=this;this.$refs.commentEditor.quill.editor.delta.ops.forEach(function(e){e.insert.image&&t.defaultComment.attach.some(function(t){return t&&t.attach_path===e.insert.image})&&(e.insert.image=t.defaultComment.attach.find(function(t){return t&&t.attach_path===e.insert.image}).attach_name)})},revertImages:function(){var t=this;this.$refs.commentEditor.quill.editor.delta.ops.forEach(function(e){e.insert.image&&t.newlyAddedImages.some(function(t){return t.attach_name===e.insert.image})?e.insert.image=t.newlyAddedImages.find(function(t){return t.attach_name===e.insert.image}).base64:e.insert.image&&t.defaultComment.attach.some(function(t){return t&&t.attach_name===e.insert.image})&&(e.insert.image=t.webUrl+t.defaultComment.attach.find(function(t){return t&&t.attach_name===e.insert.image}).attach_path)}),this.newlyAddedImages=[]},postComment:function(){var t=d(u.a.mark(function t(){var e=this;return u.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if("NEEDSUBSCRIPTION"!==this.isCommentWritable){t.next=13;break}return t.prev=1,t.next=4,this.$axios.post("/user/board",{boardId:this.boardId},{headers:{silent:!0}});case 4:t.next=11;break;case 6:if(t.prev=6,t.t0=t["catch"](1),t.t0.response&&409===t.t0.response.status){t.next=11;break}return this.$store.dispatch("showSnackbar",{text:"".concat(t.t0&&t.t0.response&&t.t0.response.data&&t.t0.response.data.message||"댓글을 쓰기 위한 구독을 하지 못했습니다."),color:"error"}),t.abrupt("return");case 11:this.$store.dispatch("addUserBoard",Object.assign({},this.$store.getters.boards.find(function(t){return t.boardId===e.boardId}))),this.$store.dispatch("showSnackbar",{text:"".concat(this.$store.getters.boards.find(function(t){return t.boardId===e.boardId}).boardName," 토픽을 구독하였습니다."),color:"info"});case 13:if(""!==this.$refs.commentEditor.quill.getText().replace(/\n/g,"").trim()||!this.$refs.commentEditor.quill.editor.delta.ops.every(function(t){return"string"===typeof t.insert})){t.next=16;break}return this.$store.dispatch("showSnackbar",{text:"댓글 내용을 입력해주세요.",color:"error"}),t.abrupt("return");case 16:try{this.$refs.commentEditor.quill.emitter.emit("text-change",this.$refs.commentEditor.quill.editor.delta)}catch(n){}if(t.prev=17,this.formData||(this.formData=new FormData),this.attachImages(),!this.defaultComment){t.next=24;break}return t.next=23,this.updateComment();case 23:return t.abrupt("return");case 24:this.loading=!0,this.formData.append("documentId",this.$route.params.documentId),this.formData.append("contents",JSON.stringify(this.$refs.commentEditor.quill.editor.delta)),this.formData.append("isAnonymous",this.anonymous),this.commentTo&&this.formData.append("parentCommentId",this.commentTo),this.$axios.post("/comment",this.formData,{headers:{silent:!0}}).then(function(t){e.$refs.commentEditor.quill.setText(""),e.revertImages(),e.loading=!1,e.$emit("update"),delete e.formData}).catch(function(t){console.log(t),delete e.formData,e.revertImages(),e.loading=!1,e.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"댓글을 등록하지 못했습니다."),color:"error"})}),t.next=39;break;case 32:t.prev=32,t.t1=t["catch"](17),this.loading=!1,console.log(t.t1),this.$store.dispatch("showSnackbar",{text:"댓글을 등록하지 못했습니다. 다시 시도해주세요.[".concat(t.t1.message||t.t1,"]"),color:"error"}),this.revertImages(),delete this.formData;case 39:case"end":return t.stop()}},t,this,[[1,6],[17,32]])}));function e(){return t.apply(this,arguments)}return e}(),updateComment:function(){var t=d(u.a.mark(function t(){var e=this;return u.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.restoreServerImages(),this.defaultComment.parentCommentId&&this.formData.append("parentCommentId",this.defaultComment.parentCommentId),this.formData.append("documentId",this.defaultComment.documentId),this.formData.append("commentId",this.defaultComment.commentId),t.next=7,this.processFileChange();case 7:if(!t.sent){t.next=12;break}this.loading=!0,this.$axios.put("/comment",{documentId:this.$route.params.documentId,commentId:this.defaultComment.commentId,contents:JSON.stringify(this.$refs.commentEditor.quill.editor.delta)}).then(function(t){e.loading=!1,e.$store.dispatch("showSnackbar",{text:"댓글을 수정하였습니다.",color:"success"}),e.$emit("update")}).catch(function(t){console.log(t),e.loading=!1,e.revertImages(),e.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"댓글을 수정하지 못했습니다. 다시 시도해주세요."),color:"error"})}),t.next=15;break;case 12:this.loading=!1,this.revertImages(),delete this.formData;case 15:t.next=24;break;case 17:t.prev=17,t.t0=t["catch"](0),this.loading=!1,console.log(t.t0),this.$store.dispatch("showSnackbar",{text:"댓글을 수정하지 못했습니다. 다시 시도해주세요.[".concat(t.t0.message||t.t0,"]"),color:"error"}),this.revertImages(),delete this.formData;case 24:case"end":return t.stop()}},t,this,[[0,17]])}));function e(){return t.apply(this,arguments)}return e}(),processFileChange:function(){var t=d(u.a.mark(function t(){var e,n,o=this;return u.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.$refs.commentEditor.quill.editor.delta.ops.filter(function(t){return t.insert.image&&o.defaultComment.attach.some(function(e){return e&&t.insert.image===e.attach_name})}).map(function(t){return o.defaultComment.attach.find(function(e){return e&&t.insert.image===e.attach_name}).attach_id}),n=[],this.defaultComment.attach.forEach(function(t){t&&t.insert&&!e.includes(t.attach_id)&&n.push(o.$axios.delete("/comment/attach/".concat(o.defaultComment.commentId,"/").concat(t.attach_id)))}),this.newlyAddedImages.length>0&&n.push(this.$axios.post("/comment/attach",this.formData)),!(n.length>0)){t.next=7;break}return t.next=7,Promise.all(n).catch(function(t){return console.log(t),o.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"댓글을 수정하지 못했습니다. 다시 시도해주세요"),color:"error"}),!1});case 7:return t.abrupt("return",!0);case 8:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}()}},h=p,f=(n("8aeb"),n("0c7c")),v=Object(f["a"])(h,a,i,!1,null,null,null),y=v.exports,b=function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("span",{staticClass:"d-inline-flex"},[""!==t.nickName?[o(t.$vuetify.breakpoint.xsOnly?"v-bottom-sheet":"v-menu",{tag:"component",attrs:{"open-on-hover":"",bottom:"",lazy:"","offset-y":""},model:{value:t.userLinkMenu,callback:function(e){t.userLinkMenu=e},expression:"userLinkMenu"}},[o("span",{staticClass:"cursor-pointer font-weight-bold body--text",attrs:{slot:"activator"},slot:"activator"},[t._v(t._s(t.nickName))]),o("v-list",{attrs:{dense:""}},["T"!==t.boardType?o("v-list-tile",{on:{click:t.showProfile}},[o("v-list-tile-title",[t._v("\n            프로필보기\n          ")])],1):t._e(),o("v-list-tile",{on:{click:t.sendMessage}},[o("v-list-tile-title",[t._v("\n            메시지 보내기\n          ")])],1)],1)],1),o("v-dialog",{attrs:{"max-width":"500",lazy:""},model:{value:t.dialog,callback:function(e){t.dialog=e},expression:"dialog"}},[o("v-card",[o("v-card-title",{staticClass:"headline",attrs:{"primary-title":""}},[o("span",[t._v("프로필")]),o("v-spacer"),o("v-icon",{on:{click:function(e){t.dialog=!1}}},[t._v("close")])],1),o("v-card-text",[o("v-flex",{attrs:{xs12:""}},[o("div",{staticClass:"text-xs-center justify-center align-center"},[o("p",[o("v-avatar",{attrs:{size:"200"}},[o("img",{attrs:{src:t.profile.picturePath?t.webUrl+t.profile.picturePath:n("53c0"),alt:"프로필 이미지"}})])],1),o("v-layout",{attrs:{row:"",wrap:""}},[o("v-flex",{attrs:{xs4:""}},[o("v-subheader",[t._v("라운지 필명")])],1),o("v-flex",{attrs:{xs8:""}},[o("div",{staticClass:"v-subheader"},[t._v(t._s(t.profile.nickName))])]),o("v-flex",{attrs:{xs4:""}},[o("v-subheader",[t._v("회원 구분")])],1),o("v-flex",{attrs:{xs8:""}},[o("div",{staticClass:"v-subheader"},[t._v(t._s(t.userAuthItems[t.profile.auth]))])]),t.profile.isOpenInfo?[o("v-flex",{attrs:{xs4:""}},[o("v-subheader",[t._v("지역")])],1),o("v-flex",{attrs:{xs8:""}},[o("div",{staticClass:"v-subheader"},[t._v(t._s(t.profile.region&&t.groupItems.some(function(e){return e.value===t.profile.region})?t.groupItems.find(function(e){return e.value===t.profile.region}).text:"지역정보 없음"))])]),o("v-flex",{attrs:{xs4:""}},[o("v-subheader",[t._v("전공")])],1),o("v-flex",{attrs:{xs8:""}},[o("div",{staticClass:"v-subheader"},[t._v(t._s(t.profile.major&&t.groupItems.some(function(e){return e.value===t.profile.major})?t.groupItems.find(function(e){return e.value===t.profile.major}).text:"전공정보 없음"))])]),o("v-flex",{attrs:{xs4:""}},[o("v-subheader",[t._v("학년")])],1),o("v-flex",{attrs:{xs8:""}},[o("div",{staticClass:"v-subheader"},[t._v(t._s(t.profile.grade&&t.groupItems.some(function(e){return e.value===t.profile.grade})?t.groupItems.find(function(e){return e.value===t.profile.grade}).text:"학년정보 없음"))])])]:o("div",{staticClass:"text-xs-center flex mt-3"},[t._v("상세 프로필이 비공개로 설정되어 있습니다.")])],2)],1)])],1),o("v-card-actions",[o("v-layout",{attrs:{row:"","text-xs-center":""}},[o("v-spacer"),o("v-btn",{on:{click:t.sendMessage}},[t._v("메시지 보내기")]),o("v-btn",{attrs:{color:"primary"},on:{click:function(e){t.dialog=!1}}},[t._v("닫기")])],1)],1)],1)],1)]:o("span",{staticClass:"grey--text lighten-1"},[t._v("익명")])],2)},g=[],x={M:"전공",G:"학년",N:"일반",R:"지역",Z:"인증"},w={name:"UserLink",props:["nickName","boardType"],data:function(){return{userLinkMenu:!1,dialog:!1,profile:{},groupItems:[],userAuthItems:{N:"예비교사(미인증)",A:"현직교사(인증)",E:"전직교사(인증 만료)",D:"인증제한"}}},mixins:[l["a"]],methods:{sendMessage:function(){var t=this;this.$axios.post("/message/list",{nickName:this.nickName,chatType:"T"===this.boardType?"T":"L"}).then(function(e){t.$router.push("/message?chatId="+e.data.chatId)}).catch(function(e){e.response&&409===e.response.status&&e.response.data.chatId?t.$router.push("/message?chatId="+e.response.data.chatId):(console.log(e),t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"채팅을 만들지 못했습니다."),color:"error"}))})},showProfile:function(){var t=this;this.profile&&this.profile.nickName===this.nickName?this.dialog=!0:this.$axios.get("/profile",{params:{nickName:this.nickName}}).then(function(e){t.profile=e.data,t.dialog=!0}).catch(function(e){console.log(e),t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"프로필을 불러오지 못했습니다."),color:"error"})})}},created:function(){var t=this;this.$store.getters.groups?this.groupItems=this.$store.getters.groups:this.$axios.get("/group",{headers:{silent:!0}}).then(function(e){e.data.forEach(function(t){"N"!==t.groupType&&"D"!==t.groupType&&"E"!==t.groupType||(t.groupType="Z")}),t.groupItems=e.data.sort(function(t,e){return t.groupType<e.groupType?-1:t.groupType===e.groupType?0:1});var n=null,o=0;while(o<t.groupItems.length)n!==t.groupItems[o].groupType&&(n?(n=t.groupItems[o].groupType,t.groupItems.splice(o,0,{divider:!0}),o++):n=t.groupItems[o].groupType,t.groupItems.splice(o,0,{header:x[n]}),o++),o++;t.groupItems=t.groupItems.map(function(t){return t.groupName?{text:t.groupName,value:t.groupId}:t}),t.$store.dispatch("setGroups",t.groupItems)}).catch(function(e){t.$store.dispatch("showSnackbar",{text:"그룹 목록을 가져오지 못했습니다.".concat(e&&e.response&&e.response.data?"["+e.response.data.message+"]":"")})})}},C=w,I=Object(f["a"])(C,b,g,!1,null,null,null),_=I.exports,k=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-layout",{attrs:{row:""}},[n("v-flex",{attrs:{xs12:"",id:"commentList"}},[t.best&&t.best.length>0?n("v-card",{staticClass:"mb-3 elevation-1",attrs:{flat:""}},[n("v-list",{staticClass:"commentList py-0",attrs:{"two-line":""}},[t._l(t.best,function(e,o){return[n("v-list-tile",{key:"best"+o,staticClass:"bestComment"},[n("comment-item",{attrs:{comment:e,commentIndex:o,reportTypes:t.reportTypes,isBest:!0},on:{update:t.getCommentList}})],1),n("v-divider",{key:"bestDivider"+o})]})],2)],1):t._e(),n("v-card",[n("v-list",{staticClass:"commentList py-0 pb-1",attrs:{"two-line":""}},[t._l(t.commentList,function(e,o){return[n("v-list-tile",{key:o},[n("comment-item",{attrs:{comment:e,commentIndex:o,reportTypes:t.reportTypes,isAnonymous:t.isAnonymous,allowAnonymous:t.allowAnonymous,isCommentWritable:t.isCommentWritable,isAddingChild:t.openRecommentIndex===o},on:{openRecomment:t.openRecomment,update:t.getCommentList}})],1),e.children?n("div",{key:"child"+o},[e.children.length>5?n("v-list-group",{key:e.title,attrs:{"prepend-icon":e.action,lazy:""},model:{value:e.active,callback:function(n){t.$set(e,"active",n)},expression:"item.active"}},[n("v-list-tile",{attrs:{slot:"activator",avatar:""},slot:"activator"},[n("v-list-tile-action"),n("v-list-tile-title",{staticClass:"text-xs-center"},[n("small",[t._v(t._s(e.active?"답글 숨기기":"이전 "+(e.children.length-5)+"개의 답글 펼치기"))])])],1),t._l(e.children.filter(function(t,n){return n<e.children.length-5}),function(e,o){return n("div",{key:"hidden"+o},[n("v-divider",{attrs:{inset:""}}),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-action"),n("comment-item",{attrs:{comment:e,commentIndex:o,children:!0,reportTypes:t.reportTypes,isAnonymous:t.isAnonymous,allowAnonymous:t.allowAnonymous,isCommentWritable:t.isCommentWritable},on:{openRecomment:t.openRecomment,update:t.getCommentList}})],1)],1)})],2):t._e(),e.children.length>5?void 0:t._e(),t._l(e.children.length>5?e.children.filter(function(t,n){return n>=e.children.length-5}):e.children,function(e,o){return n("div",{key:o},[n("v-divider",{attrs:{inset:""}}),n("v-list-tile",{attrs:{avatar:""}},[n("v-list-tile-action"),n("comment-item",{attrs:{comment:e,commentIndex:o,children:!0,reportTypes:t.reportTypes,isAnonymous:t.isAnonymous,allowAnonymous:t.allowAnonymous,isCommentWritable:t.isCommentWritable},on:{openRecomment:t.openRecomment,update:t.getCommentList}})],1)],1)})],2):t._e(),t.openRecommentIndex===o&&"DELETED"!==t.isCommentWritable?n("v-list-tile",{key:"writer"+o,staticClass:"pl-5"},[n("div",{staticClass:"pl-2"},[n("CommentWriter",{attrs:{commentTo:e.commentId,isAnonymous:t.isAnonymous,allowAnonymous:t.allowAnonymous,isCommentWritable:t.isCommentWritable,boardId:t.boardId,focus:!0},on:{update:t.getCommentList}})],1)]):t._e(),n("v-divider",{key:"divider"+o})]})],2),t.pages>1?n("v-flex",{attrs:{"text-xs-center":"","mt-2":"",xs12:""}},[n("v-pagination",{attrs:{id:"commentPagination",length:t.pages,"total-visible":t.$vuetify.breakpoint.smAndUp?10:void 0},model:{value:t.page,callback:function(e){t.page=e},expression:"page"}})],1):t._e(),"DELETED"!==t.isCommentWritable?n("div",{staticClass:"pt-2"},[n("comment-writer",{attrs:{isAnonymous:t.isAnonymous,allowAnonymous:t.allowAnonymous,isCommentWritable:t.isCommentWritable},on:{update:t.getCommentList}})],1):t._e()],1)],1)],1)},$=[],A=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-list-tile-content",{staticClass:"py-1 px-0"},[n("v-list-tile-title",[n("v-layout",{attrs:{column:""}},[n("v-flex",[t.isBest?n("v-chip",{staticClass:"white--text ml-0 my-0 ml-3",attrs:{label:"",small:"",color:"primary"}},[t._v("베스트")]):t._e()],1),t.updatingComment?"DELETED"!==t.isCommentWritable?n("v-flex",[n("comment-writer",{attrs:{defaultComment:t.comment,isAnonymous:t.isAnonymous,allowAnonymous:t.allowAnonymous,isCommentWritable:t.isCommentWritable,focus:!0},on:{revokeUpdate:function(e){t.updatingComment=!1},update:function(e){t.updatingComment=!1,t.$emit("update")}}})],1):t._e():n("v-flex",[n("div",{class:{"commentContents ql-editor pa-0 px-3":!0,"body-1 grey--text lighten-1":t.comment.isDeleted},domProps:{innerHTML:t._s(t.comment.isDeleted?t.comment.contents:t.deltaToHTML(JSON.parse(t.comment.contents)))}})])],1)],1),t.comment.isDeleted?t._e():n("v-list-tile-sub-title",{staticClass:"px-3"},[t.updatingComment?t._e():n("v-layout",{staticClass:"body-1",attrs:{row:"",wrap:""}},[n("v-flex",{attrs:{"text-xs-left":""}},[n("user-link",{attrs:{nickName:t.comment.nickName,boardType:t.$store.getters.boardType}}),n("small",{staticClass:"accent--text"},[t._v("("+t._s(t.comment.animalName)+")")]),n("small",{staticClass:"ml-1"},[t._v(t._s(t.$moment(t.comment.writeDateTime,"YYYYMMDDHHmmss").isSame(t.$moment(),"day")?t.$moment(t.comment.writeDateTime,"YYYYMMDDHHmmss").format("HH:mm"):t.timeParser(t.comment.writeDateTime)))]),t.children||t.isBest||"DELETED"===t.isCommentWritable?t._e():n("b",{class:{"cursor-pointer":!0,"primary--text":t.isAddingChild},attrs:{title:"답글 쓰기"},on:{click:function(e){return t.$emit("openRecomment",t.commentIndex)}}},[t._v("\n          답글"+t._s(t.comment.childCount>0?"("+t.comment.childCount+")":"")+"\n        ")])],1),n("v-spacer"),n("v-flex",{attrs:{"text-xs-right":"","px-2":""}},[t.isBest?n("span",{staticClass:"cursor-pointer",attrs:{title:"추천"},on:{click:t.voteUp}},[n("v-icon",{attrs:{color:"primary",small:""}},[t._v("thumb_up")]),n("b",{staticClass:"mx-1 body--text"},[t._v(t._s(t.comment.voteUpCount))])],1):[n("span",{staticClass:"cursor-pointer",attrs:{title:"추천"},on:{click:t.voteUp}},[n("v-icon",{attrs:{color:"primary",small:""}},[t._v("thumb_up")]),n("b",{staticClass:"mx-1 body--text"},[t._v(t._s(t.comment.voteUpCount))]),t._v(" |\n          ")],1),t.comment.isWriter?[n("span",{staticClass:"cursor-pointer",on:{click:t.updateComment}},[t._v("수정")]),t._v(" |\n            "),n("span",{staticClass:"cursor-pointer",on:{click:t.deleteComment}},[t._v("삭제")])]:n("v-menu",{attrs:{"open-on-hover":"",bottom:"","offset-y":"",lazy:""}},[n("span",{staticClass:"cursor-pointer",attrs:{slot:"activator"},slot:"activator"},[t._v("신고")]),n("v-list",{attrs:{"two-line":""}},t._l(t.reportTypes,function(e,o){return n("v-list-tile",{key:e.reportTypeId,class:{"mt-2":o>0},on:{click:function(n){return t.reportComment(e)}}},[n("v-list-tile-content",[n("v-list-tile-title",[t._v(t._s(e.reportTypeName))]),n("v-list-tile-sub-title",[t._v(t._s(e.reportTypeDescription))])],1)],1)}),1)],1)]],2)],1)],1)],1)},T=[],S=n("9339"),E=n.n(S),D={props:["comment","commentIndex","children","reportTypes","isBest","isAnonymous","allowAnonymous","isCommentWritable","isAddingChild"],mixins:[l["a"]],components:{UserLink:_,CommentWriter:y},data:function(){return{updatingComment:!1}},mounted:function(){var t=this;this.$root.$on("closeEditingComment",function(){t.updatingComment=!1})},methods:{voteUp:function(){var t=this;this.$axios.post("/vote/comment",{commentId:this.comment.commentId},{headers:{silent:!0}}).then(function(e){t.comment.voteUpCount=e.data.voteUpCount}).catch(function(e){t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"추천하지 못했습니다."),color:"error"})})},deleteComment:function(){var t=this;this.$axios.put("/comment",{commentId:this.comment.commentId,isDeleted:!0}).then(function(e){t.comment.contents="삭제된 댓글입니다.",t.comment.isDeleted=!0,t.$store.dispatch("showSnackbar",{text:"댓글을 삭제하였습니다.",color:"success"})}).catch(function(e){console.log(e),t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"댓글을 삭제하지 못했습니다."),color:"error"})})},updateComment:function(){var t=this;this.$root.$emit("closeEditingComment"),this.$emit("openRecomment",-1),this.$nextTick(function(){t.updatingComment=!0})},reportComment:function(t){var e=this;this.$axios.post("/report/comment",{commentId:this.comment.commentId,reportTypeId:t.reportTypeId}).then(function(t){e.$store.dispatch("showSnackbar",{text:"댓글을 신고하였습니다.",color:"success"})}).catch(function(t){t.response&&409===t.response.status?e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"댓글을 신고하지 못했습니다.",color:"info"}):(console.log(t),e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"댓글을 신고하지 못했습니다.",color:"error"}))})},deltaToHTML:function(t){var e=this,n=document.createElement("div"),o=new E.a(n);t.ops.forEach(function(t){t.insert.hasOwnProperty("image")&&e.comment.attach.some(function(e){return e.attach_name===t.insert.image})&&(t.attributes={download:t.insert.image,alt:t.insert.image},t.insert.image=e.webUrl+e.comment.attach.find(function(e){return e.attach_name===t.insert.image}).attach_path,t.attributes.link=t.insert.image)}),o.setContents(t);var s,r=n.getElementsByClassName("ql-editor")[0].innerHTML.replace(/(<(pre|script|style|textarea)[^]+?<\/\2)|(^|>)\s+|\s+(?=<|$)/g,"$1$3");while("<p></p>"===r.slice(0,7)||"<p><br></p>"===r.slice(0,11))s="<p></p>"===r.slice(0,7)?7:11,r=r.substring(s,r.length);while("<p></p>"===r.slice(-7)||"<p><br></p>"===r.slice(-11))s="<p></p>"===r.slice(-7)?7:11,r=r.substring(0,r.length-s);return r},getImagePath:function(t){return this.comment.attach.some(function(e){return e.attachName===t})?this.webUrl+this.comment.attach.find(function(e){return e.attachName===t}).attachPath:t}}},L=D,N=(n("5185"),Object(f["a"])(L,A,T,!1,null,null,null)),M=N.exports,R={mixins:[l["a"]],components:{CommentItem:M,CommentWriter:y},props:["isAnonymous","allowAnonymous","isCommentWritable","reportTypes","boardId","best","pages"],data:function(){return{commentList:[],openRecommentIndex:-1,page:void 0,documentId:this.$route.params.documentId}},methods:{getCommentList:function(){var t=this;this.openRecommentIndex=-1,this.$axios.get("/comment",{params:{documentId:this.$route.params.documentId,page:this.page},headers:{silent:!0}}).then(function(e){e.data.forEach(function(t){Array.isArray(t.attach)&&(t.attach=t.attach.filter(function(t){return t}))}),t.commentList=e.data}).catch(function(t){return console.log(t)})},openRecomment:function(t){this.openRecommentIndex===t?this.openRecommentIndex=-1:this.openRecommentIndex=t,-1!==this.openRecommentIndex&&this.$root.$emit("closeEditingComment")}},watch:{"$route.params":{handler:function(){var t=this;this.page&&this.documentId===this.$route.params.documentId||this.$nextTick(function(){t.documentId=t.$route.params.documentId,t.page=t.pages})},deep:!0,immediate:!0},page:function(t){if(this.commentList)try{document.getElementById("commentList").scrollIntoView({behavior:"smooth",block:"start"})}catch(e){}this.getCommentList()},documentId:function(t){this.getCommentList()},pages:function(t){this.page=this.pages}}},W=R,B=(n("f812"),Object(f["a"])(W,k,$,!1,null,null,null)),U=B.exports,O={props:["board","boardId","documentId"],data:function(){return{document:null,documentHTML:null,showAttach:!1,scrapGroups:null,reportTypes:null,scrapMenu:!1,reportMenu:!1}},components:{Survey:r["a"],CommentWriter:y,ViewComments:U,UserLink:_},mixins:[l["a"]],created:function(){this.getScrapGroups(),this.getReportTypes()},computed:{isCommentWritable:function(){var t=this,e=this.board.boardId===this.document.boardId?this.board:this.$store.getters.boards.find(function(e){return e.boardId===t.document.boardId});if(!e)return"UNAVAILABLE";if(this.document.isDeleted)return"DELETED";var n=this.$store.getters.profile,o=this.$store.getters.userBoards;if(e.statusAuth.comment.includes(n.auth)){if("T"===e.boardType){if(o.some(function(t){return t.boardId===e.boardId})){var s=o.find(function(t){return t.boardId===e.boardId});return!s.writeRestrictDate||this.$moment(s.writeRestrictDate,"YYYYMMDD").isBefore(this.$moment())?"AVAILABLE":"RESTRICTED"}return"READWRITE"===e.allGroupAuth||e.allowedGroups.some(function(t){return t===n.region||t===n.major||t===n.grade||n.groups.includes(t)})?"NEEDSUBSCRIPTION":"UNAVAILABLE"}if("N"===e.boardType||"E"===e.boardType||"X"===e.boardType)return"AVAILABLE";if(e.allowedGroups.some(function(t){return t===n.region||t===n.major||t===n.grade||n.groups.includes(t)})){if(o.some(function(t){return t.boardId===e.boardId})){var r=o.find(function(t){return t.boardId===e.boardId});return!r.writeRestrictDate||this.$moment(r.writeRestrictDate,"YYYYMMDD").isBefore(this.$moment())?"AVAILABLE":"RESTRICTED"}return"AVAILABLE"}return"UNAVAILABLE"}return"UNAVAILABLE"},pages:function(){return 0===this.document.commentCount?1:Math.ceil(this.document.commentCount/100)}},methods:{getDocument:function(){var t=this;this.$axios.get("/".concat(this.boardId,"/").concat(this.documentId)).then(function(e){if(e.data.isDeleted)return t.$router.replace("/"+t.boardId),void t.$store.dispatch("showSnackbar",{text:"삭제된 글입니다.",color:"warning"});Array.isArray(e.data.attach)&&(e.data.attach=e.data.attach.filter(function(t){return null!==t})),t.document=e.data,t.documentHTML=t.document.isDeleted?t.document.contents:t.deltaToHTML(JSON.parse(t.document.contents)),t.showAttach=!1,t.$emit("update:documentBoardId",t.document.boardId)}).catch(function(e){console.log(e),t.$router.replace("/error?error="+(e&&e.response&&e.response.status||"404"))})},deleteDocument:function(){var t=this;confirm("이 글을 삭제하시겠습니까?")&&this.$axios.put("/document",{documentId:this.documentId,isDeleted:!0}).then(function(e){t.$store.dispatch("showSnackbar",{text:"글을 삭제하였습니다.",color:"success"}),t.$router.push("/".concat(t.boardId))}).catch(function(e){t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"글을 삭제하지 못했습니다."),color:"error"})})},voteDocument:function(){var t=this;this.$axios.post("/vote/document",{documentId:this.document.documentId},{headers:{silent:!0}}).then(function(e){t.document.voteUpCount=e.data.voteUpCount}).catch(function(e){console.log(e.response),t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"추천하지 못했습니다."),color:"error"})})},deltaToHTML:function(t){var e,n=this,o=document.createElement("div"),s=new E.a(o);t.ops.forEach(function(t){t.insert.hasOwnProperty("image")&&(e=n.document.attach.find(function(e){return e.attach_name===t.insert.image}),e&&(e.insert=!0,t.attributes={download:t.insert.image,alt:t.insert.image},t.insert.image=n.webUrl+e.attach_path,t.attributes.link=t.insert.image))}),s.setContents(t);var r,a=o.getElementsByClassName("ql-editor")[0].innerHTML.replace(/(<(pre|script|style|textarea)[^]+?<\/\2)|(^|>)\s+|\s+(?=<|$)/g,"$1$3");while("<p></p>"===a.slice(0,7)||"<p><br></p>"===a.slice(0,11))r="<p></p>"===a.slice(0,7)?7:11,a=a.substring(r,a.length);while("<p></p>"===a.slice(-7)||"<p><br></p>"===a.slice(-11))r="<p></p>"===a.slice(-7)?7:11,a=a.substring(0,a.length-r);return a},reportDocument:function(t){var e=this;this.$axios.post("/report/document",{documentId:this.document.documentId,reportTypeId:t.reportTypeId}).then(function(t){e.reportMenu=!1,e.$store.dispatch("showSnackbar",{text:"이 글을 신고하였습니다.",color:"success"})}).catch(function(t){t.response&&409===t.response.status?(e.reportMenu=!1,e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"글을 신고하지 못했습니다.",color:"info"})):(console.log(t),e.reportMenu=!1,e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"글을 신고하지 못했습니다.",color:"error"}))})},scrapDocument:function(t){var e=this;this.$axios.post("/scrap",{scrapGroupId:t.scrapGroupId,documentId:this.document.documentId}).then(function(t){e.scrapMenu=!1,e.$store.dispatch("showSnackbar",{text:"이 글을 스크랩하였습니다.",color:"success"})}).catch(function(t){t.response&&409===t.response.status?(e.scrapMenu=!1,e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"스크랩에 추가하지 못했습니다.",color:"info"})):(console.log(t),e.scrapMenu=!1,e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"스크랩에 추가하지 못했습니다.",color:"error"}))})},getScrapGroups:function(){var t=this;this.scrapGroups||(this.$store.getters.scrapGroups?this.scrapGroups=this.$store.getters.scrapGroups:this.$axios.get("/scrap/group",{headers:{silent:!0}}).then(function(e){t.$store.dispatch("setScrapGroups",e.data),t.scrapGroups=e.data}).catch(function(e){console.log(e),t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"스크랩 그룹 목록을 가져오지 못했습니다.",color:"error"})}))},getReportTypes:function(){var t=this;this.reportTypes||(this.$store.getters.reportTypes?this.reportTypes=this.$store.getters.reportTypes:this.$axios.get("/report/type",{headers:{silent:!0}}).then(function(e){t.$store.dispatch("setReportTypes",e.data),t.reportTypes=e.data}).catch(function(e){console.log(e),t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"신고 타입을 가져오지 못했습니다.",color:"error"})}))},setNotice:function(t){var e=this;this.$axios.put("/board/notice",{boardId:this.document.boardId,documentId:this.document.documentId,isAdd:t}).then(function(n){e.$emit("updateBoardNotice",{boardId:e.document.boardId,documentId:e.document.documentId,isAdd:t,title:e.document.title})}).catch(function(t){console.log(t),e.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"글을 공지로 지정하지 못했습니다.",color:"error"})})}},watch:{"$route.params":{handler:function(){this.getDocument()},deep:!0,immediate:!0}}},j=O,q=(n("8a1f"),Object(f["a"])(j,o,s,!1,null,null,null));e["default"]=q.exports},f812:function(t,e,n){"use strict";var o=n("4bc5"),s=n.n(o);s.a}}]);