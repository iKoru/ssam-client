(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64de6f28"],{"0586":function(t,e,s){},2558:function(t,e,s){},"437a":function(t,e,s){"use strict";var n=s("2558"),r=s.n(n);r.a},"475a":function(t,e,s){},5347:function(t,e,s){"use strict";var n=s("c1df"),r=s.n(n),a={data:function(){return{boardTypeItems:{T:"토픽",L:"라운지",D:"아카이브",X:"게시판",E:"전직교사",N:"예비교사"},webUrl:"https://pedagy.com"}},methods:{uuid:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},dataURItoBlob:function(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var s=t.split(",")[0].split(":")[1].split(";")[0],n=new Uint8Array(e.length),r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return new Blob([n],{type:s})},timeParser:function(t){return r()(t,"YYYYMMDDHHmmss").fromNow()}}};e["a"]=a},"88dd":function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.survey?s("v-layout",{staticClass:"border-light py-2",attrs:{column:""}},[s("v-flex",[s("v-layout",{attrs:{row:"","align-center":"","mx-2":""}},[t.onlyView?s("span",{staticClass:"subheading"},[t._v("글 작성 후에 수정/삭제가 불가능합니다.")]):s("span",{staticClass:"subheading"},[t._v("설문조사")]),s("v-spacer"),s("span",{directives:[{name:"show",rawName:"v-show",value:t.finalResults,expression:"finalResults"}],staticStyle:{"white-space":"nowrap"}},[t._v("\n        "+t._s(t.survey.participants)+"명 참여\n      ")])],1)],1),t._l(t.survey.surveyContents.questions,function(e,n){return s("v-flex",{key:n,staticClass:"px-3 pt-2"},[s("div",{attrs:{id:"poll"}},[s("div",{staticClass:"font-weight-bold body-2 mb-2"},[t._v(t._s(n+1+". "+e.title)),e.allowMultipleChoice?s("small",{staticClass:"grey--text lighten-1"},[t._v("(복수응답)")]):t._e()]),s("div",{staticClass:"ans-cnt"},t._l(e.choices,function(r,a){return s("div",{key:a,staticClass:"ans"},[t.finalResults?[s("div",{class:{"ans-voted final multi-row":!0,selected:r.selected,"font-weight-bold":e.mostVotes==r.votes}},[r.percent?s("span",{staticClass:"percent"},[t._v(t._s(r.percent))]):t._e(),s("span",{staticClass:"txt"},[t._v(t._s(r.text))])]),s("span",{staticClass:"bg",style:{width:r.percent}})]:[s("div",{class:{"ans-no-vote multi-row":!0,active:r.selected},on:{click:function(e){return t.handleVote(n,r)}}},[s("span",{staticClass:"txt"},[t._v(t._s(r.text))])]),s("span",{staticClass:"bg"})]],2)}),0)]),n+1!==t.survey.surveyContents.questions.length?s("v-divider",{key:"divider"+n,staticClass:"mt-3"}):t._e()],1)}),t.survey.participated||t.onlyView?t._e():s("v-flex",[s("v-layout",{attrs:{"justify-center":"","my-2":""}},[s("v-btn",{attrs:{small:""},on:{click:function(e){t.showSurveyResult=!t.showSurveyResult}}},[t._v("\n        "+t._s(t.showSurveyResult?"돌아가기":"결과보기")+"\n      ")]),s("v-btn",{attrs:{small:"",color:"primary",disabled:t.finalResults},on:{click:t.completeSurvey}},[t._v("응답하기")])],1)],1)],2):t._e()},r=[],a={props:["currentSurvey","onlyView"],data:function(){return{showSurveyResult:!1,survey:null}},created:function(){this.survey=this.formatSurvey(this.currentSurvey)},computed:{finalResults:function(){return this.survey.participated||this.showSurveyResult}},methods:{formatSurvey:function(t){var e=t.surveyAnswers;return t.surveyContents.questions.forEach(function(t,s){var n=[],r=0,a=0;t.choices.forEach(function(t,i){e.length>s?(n.push({text:t,selected:!1,votes:e[s][i]}),e[s][i]>r&&(r=e[s][i]),a+=e[s][i]):n.push({text:t,selected:!1,votes:0})}),t.mostVotes=r,t.totalVotes=a,0===a?n.forEach(function(t){t.percent="0%"}):n.forEach(function(t){t.percent=!isNaN(t.votes)&&t.votes>0?Math.round(parseInt(t.votes)/a*100)+"%":"0%"}),t.choices=n}),t},getAnswerArray:function(t){var e=[];return t.forEach(function(t){if(t.allowMultipleChoice){var s=[];t.choices.forEach(function(t,e){t.selected&&s.push(e)}),e.push(s)}else e.push(t.choices.findIndex(function(t){return t.selected}))}),e},completeSurvey:function(){var t=this;if(this.survey.surveyContents.questions.every(function(t){return t.choices.some(function(t){return t.selected})})){if(this.survey.participated)return void this.$store.dispatch("showSnackbar",{text:"이미 참여한 설문입니다.",color:"info"});var e=this.getAnswerArray(this.survey.surveyContents.questions);this.$axios.post("/survey",{documentId:this.$route.params.documentId,answer:e}).then(function(e){console.log(e),e.data.survey?(t.survey=t.formatSurvey(e.data.survey),t.showSurveyResult=!0):t.$axios.get("/".concat(t.$route.params.boardId,"/").concat(t.$route.params.documentId)).then(function(e){t.survey=t.formatSurvey(e.data.survey),console.log(t.survey),t.showSurveyResult=!0}).catch(function(t){console.log(t)})}).catch(function(e){e.response&&409===e.response.status?t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"info"}):t.$store.dispatch("showSnackbar",{text:e.response&&e.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"error"})})}else this.$store.dispatch("showSnackbar",{text:this.survey.surveyContents.questions.findIndex(function(t){return!t.choices.some(function(t){return t.selected})})+1+"번 질문의 응답을 선택해주세요.",color:"warning"})},handleVote:function(t,e){this.survey.surveyContents.questions[t].allowMultipleChoice||e.selected||this.survey.surveyContents.questions[t].choices.forEach(function(t){return t.selected=!1}),e.selected=!e.selected}}},i=a,o=(s("437a"),s("0c7c")),c=Object(o["a"])(i,n,r,!1,null,null,null);e["a"]=c.exports},ace1:function(t,e,s){"use strict";var n=s("475a"),r=s.n(n);r.a},b76b:function(t,e,s){"use strict";var n=s("0586"),r=s.n(n);r.a},ec84:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-layout",{attrs:{column:"","mx-1":t.$vuetify.breakpoint.smAndUp,"mt-1":t.$vuetify.breakpoint.smAndUp}},[s("v-flex",{staticClass:"mb-0 pb-0",attrs:{id:"title"}},[s("v-text-field",{staticClass:"dense",attrs:{placeholder:"제목",flat:t.$vuetify.breakpoint.xsOnly,readonly:!!t.documentId,solo:"","hide-details":""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),s("v-flex",{attrs:{xs12:"",id:"write-editor"}},[s("quill-editor",{ref:"editor",attrs:{options:t.editorOption},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}},[s("div",{attrs:{slot:"toolbar",id:"toolbar"},slot:"toolbar"},[s("button",{staticClass:"ql-bold"},[t._v("Bold")]),s("button",{staticClass:"ql-italic"},[t._v("Italic")]),s("select",{staticClass:"ql-size"},[s("option",{attrs:{value:"small"}},[t._v("작게")]),s("option",{attrs:{selected:""}},[t._v("보통")]),s("option",{attrs:{value:"large"}},[t._v("크게")]),s("option",{attrs:{value:"huge"}},[t._v("더 크게")])])])])],1),s("div",[t._v(t._s(t.savedContent))]),t.documentId?t._e():s("v-dialog",{attrs:{"max-width":"500px",fullscreen:t.$vuetify.breakpoint.xsOnly,scrollable:""},model:{value:t.surveyDialog,callback:function(e){t.surveyDialog=e},expression:"surveyDialog"}},[s("survey-maker",{attrs:{survey:t.survey,isSurveyDeletable:t.isSurveyDeletable,dialog:t.surveyDialog},on:{deleteSurvey:t.deleteSurvey,closeSurvey:t.closeSurvey,extractSurvey:t.extractSurvey}})],1),s("v-layout",{attrs:{"pt-1":"","pl-2":"","align-center":""}},[s("div",[t.documentId?t.survey?s("div",{staticClass:"body-1 primary--text mr-2",attrs:{title:"등록한 설문조사는 수정할 수 없습니다."}},[s("v-icon",{staticClass:"primary--text cursor-default vertical-align-middle"},[t._v("how_to_vote")]),s("span",{staticClass:"cursor-default"},[t._v("설문조사")])],1):t._e():s("v-btn",{attrs:{small:"",flat:"",color:t.isSurveyDeletable?"primary":"default"},on:{click:t.surveyButtonClick}},[s("v-icon",[t._v("how_to_vote")]),s("span",[t._v("설문조사")])],1)],1),s("div",[s("v-btn",{attrs:{small:"",flat:""},on:{click:t.selectImage}},[s("v-icon",[t._v("image")]),t._v("이미지\n      ")],1)],1),s("div",[s("v-btn",{attrs:{small:"",flat:""},on:{click:t.openFileDialog}},[s("v-icon",[t._v("attach_file")]),t._v("파일첨부\n      ")],1)],1)]),s("input",{ref:"fileInput",staticClass:"d-none",attrs:{multiple:"",id:"file-upload",accept:"application/zip, application/x-zip-compressed, multipart/x-zip, application/x-hwp, application/pdf, image/*, application/vnd.openxmlformats-officedocument.wordprocessingml.*, application/msword, application/vnd.ms-powerpoint, audio/*, video/*, application/vnd.ms-excel, application/haansofthwp, application/haansoftxlsx, application/haansoftxls, application/haansoftpptx, application/haansoftppt, application/haansoftdocx, application/haansoftdoc",type:"file",value:"",capture:"filesystem"},on:{click:function(e){t.$refs.fileInput.value=null},change:t.onFileChange}}),s("v-slide-y-transition",[t.attachedFilenames.length>0?s("v-layout",{staticClass:"border-light",attrs:{wrap:""}},t._l(t.attachedFilenames,function(e,n){return s("v-flex",{key:n,attrs:{xs6:"",md4:"","px-2":""}},[s("v-slide-y-transition",[s("v-layout",{attrs:{row:"","align-center":""}},[s("div",{staticClass:"ellipsis"},[t._v(t._s(e))]),s("v-spacer"),s("v-btn",{staticClass:"short",attrs:{small:""},on:{click:function(e){return t.removeFile(n)}}},[t._v("삭제")])],1)],1)],1)}),1):t._e()],1),t.board.allowAnonymous?s("v-layout",{attrs:{"py-2":"","ml-3":"","justify-center":""}},[s("div",{staticClass:"mr-3"},[s("v-checkbox",{staticClass:"mr-1 my-auto mb-0",attrs:{"hide-details":"",label:"익명"},model:{value:t.isAnonymous,callback:function(e){t.isAnonymous=e},expression:"isAnonymous"}})],1),s("div",[s("v-checkbox",{staticClass:"mr-1 my-auto mb-0",attrs:{disabled:t.isAnonymous,"hide-details":"",label:"익명댓글불가"},model:{value:t.disallowAnonymous,callback:function(e){t.disallowAnonymous=e},expression:"disallowAnonymous"}})],1),s("v-spacer")],1):t._e(),s("v-layout",{attrs:{row:"","mt-3":""}},[s("v-flex",{attrs:{"text-xs-center":""}},[s("v-btn",{on:{click:function(e){return t.$router.go(-1)}}},[t._v("돌아가기")]),s("v-btn",{staticClass:"primary",on:{click:function(e){return t.post()}}},[t._v(t._s(t.documentId?"수정":"등록"))])],1)],1)],1)},r=[],a=s("a34a"),i=s.n(a),o=s("88dd"),c=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",[s("v-toolbar",{attrs:{flat:""}},[s("v-toolbar-title",[t._v("설문조사")]),s("v-spacer"),s("v-btn",{staticClass:"toolbar-btn-last",attrs:{icon:""},on:{click:function(e){return t.$emit("closeSurvey")}}},[s("v-icon",[t._v("close")])],1)],1),s("v-card-text",{staticClass:"pb-0"},[s("v-layout",{attrs:{column:""}},[s("div",{staticClass:"border-light",attrs:{id:"surveyMaker"}},t._l(t.currentSurvey.questions,function(e,n){return s("v-flex",{key:n},[s("v-card",{attrs:{flat:""}},[s("v-card-title",{staticClass:"pb-1"},[t._v("\n              "+t._s(n+1)+".\n              "),s("v-text-field",{staticClass:"dense mt-0 pt-0 ml-2",attrs:{"single-line":"","hide-details":"",dense:"",placeholder:"질문 내용","append-outer-icon":"close"},on:{"click:append-outer":function(e){return t.deleteQuestion(n)}},model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"question.title"}})],1),s("v-card-text",{staticClass:"py-0"},[s("v-layout",{attrs:{column:""}},[t._l(e.choices,function(r,a){return s("v-flex",{key:a,staticClass:"mt-2"},[s("v-text-field",{staticClass:"pt-1 dense",attrs:{box:"","single-line":"",placeholder:"선택지"+(a+1),"hide-details":"","append-icon":"delete"},on:{"click:append":function(e){return t.deleteAnswer(n,a)}},model:{value:e.choices[a],callback:function(s){t.$set(e.choices,a,s)},expression:"question.choices[answerIndex]"}})],1)}),s("v-flex",[s("v-layout",{attrs:{row:"","align-center":"","justify-space-around":""}},[s("v-flex",{attrs:{"text-xs-center":""}},[s("v-btn",{attrs:{flat:""},on:{click:function(e){return t.addAnswer(n)}}},[s("v-icon",{staticClass:"mr-1",attrs:{small:""}},[t._v("add")]),t._v("선택지 추가\n                      ")],1)],1),s("v-flex",{attrs:{"text-xs-center":""}},[s("v-checkbox",{staticClass:"mt-0 pt-0",attrs:{"hide-details":"",label:"복수응답 허용"},model:{value:e.allowMultipleChoice,callback:function(s){t.$set(e,"allowMultipleChoice",s)},expression:"question.allowMultipleChoice"}})],1)],1)],1)],2)],1)],1),n!==t.currentSurvey.questions.length-1?s("v-divider",{staticClass:"mx-4"}):t._e()],1)}),1),s("v-flex",{attrs:{"mt-3":""}},[s("v-btn",{attrs:{block:"",flat:""},on:{click:t.pushQuestion}},[s("v-icon",[t._v("playlist_add")]),s("v-label",{attrs:{size:"24"}},[t._v("질문추가")])],1)],1)],1)],1),s("v-card-actions",{staticClass:"align-start"},[s("v-spacer"),s("v-btn",{attrs:{color:"error",depressed:"",disabled:!t.isSurveyDeletable},on:{click:function(e){return t.$emit("deleteSurvey")}}},[t._v("설문 삭제")]),s("v-btn",{attrs:{color:"primary",depressed:""},on:{click:t.extractSurvey}},[t._v("저장")])],1)],1)},l=[],u={props:["survey","isSurveyDeletable","dialog"],data:function(){return{currentSurvey:{}}},methods:{addAnswer:function(t){this.currentSurvey.questions[t].choices.push("")},deleteAnswer:function(t,e){this.currentSurvey.questions[t].choices.length<3?this.currentSurvey.questions[t].choices[e]&&this.currentSurvey.questions[t].choices[e].length>0?(this.currentSurvey.questions[t].choices[e]="",this.$forceUpdate()):this.$store.dispatch("showSnackbar",{text:"선택지는 2개 이상이어야 합니다.",color:"info"}):this.currentSurvey.questions[t].choices.splice(e,1)},pushQuestion:function(){this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]})},deleteQuestion:function(t){1===this.currentSurvey.questions.length?this.currentSurvey.questions[t].title&&this.currentSurvey.questions[t].title.length>0||this.currentSurvey.questions[t].choices.some(function(t){return t&&t.length>0})?(this.currentSurvey.questions.splice(t,1),this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]})):this.$store.dispatch("showSnackbar",{text:"최소 하나 이상의 질문을 입력해주세요",color:"warning"}):this.currentSurvey.questions.splice(t,1)},extractSurvey:function(){var t=0;while(t<this.currentSurvey.questions.length)if(this.currentSurvey.questions[t].title&&this.currentSurvey.questions[t].title.length>0){if(!(this.currentSurvey.questions[t].choices.filter(function(t){return t&&t.length>0}).length>1))return void this.$store.dispatch("showSnackbar",{text:t+1+"번째 질문의 응답을 2개 이상으로 입력해주세요.",color:"info"});this.currentSurvey.questions[t].choices=this.currentSurvey.questions[t].choices.filter(function(t){return t&&t.length>0}),t++}else{if(this.currentSurvey.questions[t].choices.some(function(t){return t&&t.length>0}))return void this.$store.dispatch("showSnackbar",{text:t+1+"번째 질문의 제목을 입력해주세요.",color:"info"});this.currentSurvey.questions.splice(t,1)}0!==t?this.$emit("extractSurvey",this.currentSurvey):this.$store.dispatch("showSnackbar",{text:"질문을 1개 이상 입력해주세요.",color:"warning"})}},watch:{dialog:function(t){t&&(this.currentSurvey=JSON.parse(JSON.stringify(this.survey)))}}},h=u,d=(s("b76b"),s("0c7c")),v=Object(d["a"])(h,c,l,!1,null,null,null),p=v.exports,f=s("5347");function m(t,e,s,n,r,a,i){try{var o=t[a](i),c=o.value}catch(l){return void s(l)}o.done?e(c):Promise.resolve(c).then(n,r)}function y(t){return function(){var e=this,s=arguments;return new Promise(function(n,r){var a=t.apply(e,s);function i(t){m(a,n,r,i,o,"next",t)}function o(t){m(a,n,r,i,o,"throw",t)}i(void 0)})}}var b={name:"Editor",components:{SurveyMaker:p,Survey:o["a"]},props:["documentId","board"],mixins:[f["a"]],data:function(){return{savedContent:void 0,link:void 0,title:null,content:"",surveyDialog:!1,survey:{questions:[]},isSurveyDeletable:!1,editorOption:{placeholder:"내용을 입력해주세요.",modules:{toolbar:"#toolbar",magicUrl:{urlRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,globalRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,normalizeRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/},imageDrop:!0,imageResize:!0},theme:this.$vuetify.breakpoint.xsOnly?"bubble":"snow"},show:!1,isAnonymous:!1,disallowAnonymous:!1,formData:void 0,rawFileData:void 0,attachedFilenames:[],attachFromServer:void 0,originImages:[]}},methods:{onEditorChange:function(t){t.quill;var e=t.html;t.text;this.content=e},post:function(){var t=y(i.a.mark(function t(){return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.title&&""!==this.title.trim()){t.next=5;break}return this.$store.dispatch("showSnackbar",{text:"글 제목을 입력해주세요.",color:"error"}),t.abrupt("return");case 5:if(this.content&&""!==this.content.trim()){t.next=8;break}return this.$store.dispatch("showSnackbar",{text:"글 내용을 입력해주세요.",color:"error"}),t.abrupt("return");case 8:if(!this.documentId){t.next=13;break}return t.next=11,this.uploadModifiedDocument();case 11:t.next=15;break;case 13:return t.next=15,this.uploadDocument();case 15:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),uploadDocument:function(){var t=y(i.a.mark(function t(){var e=this;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return this.formData||(this.formData=new FormData),t.next=3,this.attachImages();case 3:return this.formData.append("boardId",this.$route.params.boardId),this.formData.append("title",this.title),this.formData.append("contents",JSON.stringify(this.$refs.editor.quill.editor.delta)),this.formData.append("isAnonymous",this.isAnonymous),this.formData.append("allowAnonymous",!!this.isAnonymous||!this.disallowAnonymous),this.isSurveyDeletable&&this.formData.append("survey",JSON.stringify(this.survey)),t.next=11,this.processUploadFiles();case 11:return t.abrupt("return",this.$axios.post("/document",this.formData).then(function(t){200===t.status&&e.$router.push("/".concat(e.$route.params.boardId,"/").concat(t.data.documentId))}).catch(function(t){console.log(t),e.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"글을 등록하지 못했습니다. 다시 시도해주세요"),color:"error"}),delete e.formData,e.revertImages()}));case 12:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),uploadModifiedDocument:function(){var t=y(i.a.mark(function t(){var e,s=this;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.formData||(this.formData=new FormData),this.formData.append("documentId",this.documentId),t.next=5,this.attachImages();case 5:return t.next=7,this.processFileChange();case 7:return e={documentId:this.documentId,title:this.title,contents:JSON.stringify(this.$refs.editor.quill.editor.delta)},t.abrupt("return",this.$axios.put("/document",e).then(function(t){200===t.status&&(s.$store.dispatch("showSnackbar",{text:"글을 수정하였습니다",color:"success"}),s.$router.push("/".concat(s.$route.params.boardId,"/").concat(s.documentId)))}).catch(function(t){console.log(t),s.revertImages(),delete s.formData,s.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"글을 수정하지 못했습니다. 다시 시도해주세요"),color:"error"})}));case 11:t.prev=11,t.t0=t["catch"](0),console.log(t.t0),this.$store.dispatch("showSnackbar",{text:"".concat(t.t0.response?t.t0.response.data.message:"글을 수정하지 못했습니다. 다시 시도해주세요"),color:"error"}),this.revertImages(),delete this.formData;case 17:case"end":return t.stop()}},t,this,[[0,11]])}));function e(){return t.apply(this,arguments)}return e}(),attachImages:function(){var t=this;return this.$refs.editor.quill.editor.delta.ops.forEach(function(e){if(e.insert.hasOwnProperty("image")&&e.insert.image.includes("data:image")){var s=e.insert.image,n=t.uuid()+"."+s.substring("data:image/".length,s.indexOf(";base64"));t.formData.append("attach",t.dataURItoBlob(s),n),e.insert.image=n,t.originImages.push({name:n,src:s})}})},revertImages:function(){var t=this;this.$refs.editor.quill.editor.delta.ops.forEach(function(e){if(e.insert.hasOwnProperty("image")){var s=e.insert.image;e.insert.image=t.originImages.find(function(t){return t.name===s}).src}}),this.originImages=[]},processFileChange:function(){var t=y(i.a.mark(function t(){var e,s,n,r,a,o,c,l,u,h,d,v=this;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.$refs.editor.quill.editor.delta.ops.map(function(t){if(t.insert.hasOwnProperty("image")&&t.insert.image.startsWith("/attach"))return v.attachFromServer.find(function(e){return t.insert.image==="/"+e.attach_path}).attach_id}),this.attachFromServer=this.attachFromServer.filter(function(t){return null!==t}),this.attachFromServer.forEach(function(t){t.insert&&!e.filter(function(t){return void 0!==t}).includes(t.attach_id)?s=v.$axios.delete("/document/attach/".concat(v.documentId,"/").concat(t.attach_id)).catch(function(t){console.log(t)}):v.attachedFilenames.includes(t.attach_name)||t.insert||(n=v.$axios.delete("/document/attach/".concat(v.documentId,"/").concat(t.attach_id)).catch(function(t){console.log(t)}))}),t.next=5,this.processUploadFiles();case 5:for(a=0,o=!0,c=!1,l=void 0,t.prev=9,u=this.formData.entries()[Symbol.iterator]();!(o=(h=u.next()).done);o=!0)d=h.value,"attach"===d[0]&&(a+=1);t.next=17;break;case 13:t.prev=13,t.t0=t["catch"](9),c=!0,l=t.t0;case 17:t.prev=17,t.prev=18,o||null==u.return||u.return();case 20:if(t.prev=20,!c){t.next=23;break}throw l;case 23:return t.finish(20);case 24:return t.finish(17);case 25:return a>0&&(r=this.$axios.post("/document/attach",this.formData).catch(function(t){console.log(t)})),t.next=28,Promise.all([s,n,r]).catch(function(t){console.log(t),v.$store.dispatch("showSnackbar",{text:"".concat(t.response?t.response.data.message:"글을 수정하지 못했습니다. 다시 시도해주세요"),color:"error"})});case 28:case"end":return t.stop()}},t,this,[[9,13,17,25],[18,,20,24]])}));function e(){return t.apply(this,arguments)}return e}(),surveyButtonClick:function(){this.isSurveyDeletable||0!==this.survey.questions.length||this.survey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]}),this.surveyDialog=!0},extractSurvey:function(t){this.surveyDialog=!1,this.survey=JSON.parse(JSON.stringify(t)),this.isSurveyDeletable=!0},closeSurvey:function(){this.surveyDialog=!1},deleteSurvey:function(){confirm("작성된 질문 및 내용을 삭제할까요?")&&(this.surveyDialog=!1,this.survey.questions=[],this.isSurveyDeletable=!1)},parseDocument:function(t){var e,s=this;(this.title=t.title,this.contents=JSON.parse(t.contents),this.attachFromServer=t.attach,this.isAnonymous=t.isAnonymous,t.survey&&(this.survey=t.survey,this.isSurveyDeletable=!0),Array.isArray(t.attach)&&(t.attach=t.attach.filter(function(t){return null!==t})),t.attach)&&(this.contents.ops.forEach(function(n){n.insert.hasOwnProperty("image")&&(e=t.attach.find(function(t){return t.attach_name===n.insert.image}),e&&(e.insert=!0,n.insert.image=s.webUrl+"/"+e.attach_path))}),this.attachedFilenames=t.attach.filter(function(t){return!t.insert}).map(function(t){return t.attach_name}));this.$refs.editor.quill.setContents(this.contents)},attachButtonClick:function(){this.documentId?this.openFileDialog():this.$refs.pond.browse()},openFileDialog:function(){document.getElementById("file-upload").click()},onFileChange:function(){var t=y(i.a.mark(function t(e){var s,n,r;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(this.rawFileData||(this.rawFileData=new FormData),s=this,n=e.target.files||e.dataTransfer.files,!(n.length>0)){t.next=16;break}r=0;case 5:if(!(r<n.length)){t.next=16;break}if(!(n[r].size>8388608)){t.next=9;break}return this.$store.dispatch("showSnackbar",{text:"8MB 이하의 파일만 첨부가능합니다.",color:"error"}),t.abrupt("break",16);case 9:return t.next=11,s.rawFileData.append("file",n[r],n[r].name);case 11:return t.next=13,s.attachedFilenames.push(n[r].name);case 13:r++,t.next=5;break;case 16:case"end":return t.stop()}},t,this)}));function e(e){return t.apply(this,arguments)}return e}(),removeFile:function(){var t=y(i.a.mark(function t(e){var s,n,r,a,o,c,l,u;return i.a.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(!this.rawFileData){t.next=33;break}s=new FormData,n=0,r=!0,a=!1,o=void 0,t.prev=6,c=this.rawFileData.entries()[Symbol.iterator]();case 8:if(r=(l=c.next()).done){t.next=18;break}if(u=l.value,"file"!==u[0]){t.next=15;break}if(n===Number(e)){t.next=14;break}return t.next=14,s.append(u[0],u[1],u[1].name);case 14:n+=1;case 15:r=!0,t.next=8;break;case 18:t.next=24;break;case 20:t.prev=20,t.t0=t["catch"](6),a=!0,o=t.t0;case 24:t.prev=24,t.prev=25,r||null==c.return||c.return();case 27:if(t.prev=27,!a){t.next=30;break}throw o;case 30:return t.finish(27);case 31:return t.finish(24);case 32:this.rawFileData=s;case 33:this.attachedFilenames.splice(e,1);case 34:case"end":return t.stop()}},t,this,[[6,20,24,32],[25,,27,31]])}));function e(e){return t.apply(this,arguments)}return e}(),processUploadFiles:function(){this.rawFileData||(this.rawFileData=new FormData);var t={},e=!0,s=!1,n=void 0;try{for(var r,a=this.rawFileData.entries()[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var i=r.value;t[i[1].name]={count:t[i[1].name]?t[i[1].name].count+1:1,index:0}}}catch(y){s=!0,n=y}finally{try{e||null==a.return||a.return()}finally{if(s)throw n}}var o=!0,c=!1,l=void 0;try{for(var u,h=this.rawFileData.entries()[Symbol.iterator]();!(o=(u=h.next()).done);o=!0){var d=u.value,v=d[1].name.lastIndexOf("."),p=d[1].name.substring(v,d[1].name.length),f=d[1].name.substring(0,v),m="";t[d[1].name].count>0&&(m=0===t[d[1].name].index?"":" (".concat(t[d[1].name].index,")"),t[d[1].name].index+=1),this.formData.append("attach",d[1],f+m+p)}}catch(y){c=!0,l=y}finally{try{o||null==h.return||h.return()}finally{if(c)throw l}}},selectImage:function(){var t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click();var e=this;t.onchange=function(){var s=t.files[0],n=new FileReader;n.readAsDataURL(s),n.onload=function(){if(/^image\//.test(s.type)){var t=e.$refs.editor.quill.getSelection();e.$refs.editor.quill.insertEmbed(null==t?e.$refs.editor.quill.getLength():t.index,"image",n.result)}else this.$store.dispatch("showSnackbar",{text:"이미지 파일만 업로드할 수 있습니다.",color:"error"})},n.onerror=function(t){console.log("Error: ",t)}}}},computed:{editor:function(){return this.$refs.editor.quill}},watch:{isAnonymous:{handler:function(t){t&&(this.disallowAnonymous=!1)}}},created:function(){var t=this;this.$route.params.boardId&&this.documentId&&this.$axios.get("/".concat(this.$route.params.boardId,"/").concat(this.documentId)).then(function(e){t.parseDocument(e.data)}).catch(function(e){console.log(e),t.$store.dispatch("showSnackbar",{text:"".concat(e.response?e.response.data.message:"글 내용을 불러오지 못했습니다."),color:"error"}),t.$router.replace("/error?error="+(e&&e.response&&e.response.status||"404"))})}},x=b,g=(s("ace1"),Object(d["a"])(x,n,r,!1,null,null,null));e["default"]=g.exports}}]);
//# sourceMappingURL=chunk-64de6f28-legacy.3566fb3c.js.map