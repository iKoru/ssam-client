(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-64de6f28"],{"0586":function(t,e,s){},2558:function(t,e,s){},"437a":function(t,e,s){"use strict";var a=s("2558"),i=s.n(a);i.a},"475a":function(t,e,s){},5347:function(t,e,s){"use strict";var a=s("c1df"),i=s.n(a);const r={data(){return{boardTypeItems:{T:"토픽",L:"라운지",D:"아카이브",X:"게시판",E:"전직교사",N:"예비교사"},webUrl:"https://pedagy.com"}},methods:{uuid(){let t=()=>{return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},dataURItoBlob(t){var e;e=t.split(",")[0].indexOf("base64")>=0?atob(t.split(",")[1]):unescape(t.split(",")[1]);for(var s=t.split(",")[0].split(":")[1].split(";")[0],a=new Uint8Array(e.length),i=0;i<e.length;i++)a[i]=e.charCodeAt(i);return new Blob([a],{type:s})},timeParser(t){return i()(t,"YYYYMMDDHHmmss").fromNow()}}};e["a"]=r},"88dd":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.survey?s("v-layout",{staticClass:"border-light py-2",attrs:{column:""}},[s("v-flex",[s("v-layout",{attrs:{row:"","align-center":"","mx-2":""}},[t.onlyView?s("span",{staticClass:"subheading"},[t._v("글 작성 후에 수정/삭제가 불가능합니다.")]):s("span",{staticClass:"subheading"},[t._v("설문조사")]),s("v-spacer"),s("span",{directives:[{name:"show",rawName:"v-show",value:t.finalResults,expression:"finalResults"}],staticStyle:{"white-space":"nowrap"}},[t._v("\n        "+t._s(t.survey.participants)+"명 참여\n      ")])],1)],1),t._l(t.survey.surveyContents.questions,function(e,a){return s("v-flex",{key:a,staticClass:"px-3 pt-2"},[s("div",{attrs:{id:"poll"}},[s("div",{staticClass:"font-weight-bold body-2 mb-2"},[t._v(t._s(a+1+". "+e.title)),e.allowMultipleChoice?s("small",{staticClass:"grey--text lighten-1"},[t._v("(복수응답)")]):t._e()]),s("div",{staticClass:"ans-cnt"},t._l(e.choices,function(i,r){return s("div",{key:r,staticClass:"ans"},[t.finalResults?[s("div",{class:{"ans-voted final multi-row":!0,selected:i.selected,"font-weight-bold":e.mostVotes==i.votes}},[i.percent?s("span",{staticClass:"percent"},[t._v(t._s(i.percent))]):t._e(),s("span",{staticClass:"txt"},[t._v(t._s(i.text))])]),s("span",{staticClass:"bg",style:{width:i.percent}})]:[s("div",{class:{"ans-no-vote multi-row":!0,active:i.selected},on:{click:function(e){return t.handleVote(a,i)}}},[s("span",{staticClass:"txt"},[t._v(t._s(i.text))])]),s("span",{staticClass:"bg"})]],2)}),0)]),a+1!==t.survey.surveyContents.questions.length?s("v-divider",{key:"divider"+a,staticClass:"mt-3"}):t._e()],1)}),t.survey.participated||t.onlyView?t._e():s("v-flex",[s("v-layout",{attrs:{"justify-center":"","my-2":""}},[s("v-btn",{attrs:{small:""},on:{click:function(e){t.showSurveyResult=!t.showSurveyResult}}},[t._v("\n        "+t._s(t.showSurveyResult?"돌아가기":"결과보기")+"\n      ")]),s("v-btn",{attrs:{small:"",color:"primary",disabled:t.finalResults},on:{click:t.completeSurvey}},[t._v("응답하기")])],1)],1)],2):t._e()},i=[],r={props:["currentSurvey","onlyView"],data(){return{showSurveyResult:!1,survey:null}},created(){this.survey=this.formatSurvey(this.currentSurvey)},computed:{finalResults(){return this.survey.participated||this.showSurveyResult}},methods:{formatSurvey(t){let e=t.surveyAnswers;return t.surveyContents.questions.forEach((t,s)=>{let a=[],i=0,r=0;t.choices.forEach((t,o)=>{e.length>s?(a.push({text:t,selected:!1,votes:e[s][o]}),e[s][o]>i&&(i=e[s][o]),r+=e[s][o]):a.push({text:t,selected:!1,votes:0})}),t.mostVotes=i,t.totalVotes=r,0===r?a.forEach(t=>{t.percent="0%"}):a.forEach(t=>{t.percent=!isNaN(t.votes)&&t.votes>0?Math.round(parseInt(t.votes)/r*100)+"%":"0%"}),t.choices=a}),t},getAnswerArray(t){let e=[];return t.forEach(t=>{if(t.allowMultipleChoice){let s=[];t.choices.forEach((t,e)=>{t.selected&&s.push(e)}),e.push(s)}else e.push(t.choices.findIndex(t=>t.selected))}),e},completeSurvey(){if(this.survey.surveyContents.questions.every(t=>t.choices.some(t=>t.selected))){if(this.survey.participated)return void this.$store.dispatch("showSnackbar",{text:"이미 참여한 설문입니다.",color:"info"});let t=this.getAnswerArray(this.survey.surveyContents.questions);this.$axios.post("/survey",{documentId:this.$route.params.documentId,answer:t}).then(t=>{console.log(t),t.data.survey?(this.survey=this.formatSurvey(t.data.survey),this.showSurveyResult=!0):this.$axios.get(`/${this.$route.params.boardId}/${this.$route.params.documentId}`).then(t=>{this.survey=this.formatSurvey(t.data.survey),console.log(this.survey),this.showSurveyResult=!0}).catch(t=>{console.log(t)})}).catch(t=>{t.response&&409===t.response.status?this.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"info"}):this.$store.dispatch("showSnackbar",{text:t.response&&t.response.data.message||"설문 응답을 등록하지 못했습니다.",color:"error"})})}else this.$store.dispatch("showSnackbar",{text:this.survey.surveyContents.questions.findIndex(t=>!t.choices.some(t=>t.selected))+1+"번 질문의 응답을 선택해주세요.",color:"warning"})},handleVote(t,e){this.survey.surveyContents.questions[t].allowMultipleChoice||e.selected||this.survey.surveyContents.questions[t].choices.forEach(t=>t.selected=!1),e.selected=!e.selected}}},o=r,n=(s("437a"),s("0c7c")),l=Object(n["a"])(o,a,i,!1,null,null,null);e["a"]=l.exports},ace1:function(t,e,s){"use strict";var a=s("475a"),i=s.n(a);i.a},b76b:function(t,e,s){"use strict";var a=s("0586"),i=s.n(a);i.a},ec84:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-layout",{attrs:{column:"","mx-1":t.$vuetify.breakpoint.smAndUp,"mt-1":t.$vuetify.breakpoint.smAndUp}},[s("v-flex",{staticClass:"mb-0 pb-0",attrs:{id:"title"}},[s("v-text-field",{staticClass:"dense",attrs:{placeholder:"제목",flat:t.$vuetify.breakpoint.xsOnly,readonly:!!t.documentId,solo:"","hide-details":""},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}})],1),s("v-flex",{attrs:{xs12:"",id:"write-editor"}},[s("quill-editor",{ref:"editor",attrs:{options:t.editorOption},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}},[s("div",{attrs:{slot:"toolbar",id:"toolbar"},slot:"toolbar"},[s("button",{staticClass:"ql-bold"},[t._v("Bold")]),s("button",{staticClass:"ql-italic"},[t._v("Italic")]),s("select",{staticClass:"ql-size"},[s("option",{attrs:{value:"small"}},[t._v("작게")]),s("option",{attrs:{selected:""}},[t._v("보통")]),s("option",{attrs:{value:"large"}},[t._v("크게")]),s("option",{attrs:{value:"huge"}},[t._v("더 크게")])])])])],1),s("div",[t._v(t._s(t.savedContent))]),t.documentId?t._e():s("v-dialog",{attrs:{"max-width":"500px",fullscreen:t.$vuetify.breakpoint.xsOnly,scrollable:""},model:{value:t.surveyDialog,callback:function(e){t.surveyDialog=e},expression:"surveyDialog"}},[s("survey-maker",{attrs:{survey:t.survey,isSurveyDeletable:t.isSurveyDeletable,dialog:t.surveyDialog},on:{deleteSurvey:t.deleteSurvey,closeSurvey:t.closeSurvey,extractSurvey:t.extractSurvey}})],1),s("v-layout",{attrs:{"pt-1":"","pl-2":"","align-center":""}},[s("div",[t.documentId?t.survey?s("div",{staticClass:"body-1 primary--text mr-2",attrs:{title:"등록한 설문조사는 수정할 수 없습니다."}},[s("v-icon",{staticClass:"primary--text cursor-default vertical-align-middle"},[t._v("how_to_vote")]),s("span",{staticClass:"cursor-default"},[t._v("설문조사")])],1):t._e():s("v-btn",{attrs:{small:"",flat:"",color:t.isSurveyDeletable?"primary":"default"},on:{click:t.surveyButtonClick}},[s("v-icon",[t._v("how_to_vote")]),s("span",[t._v("설문조사")])],1)],1),s("div",[s("v-btn",{attrs:{small:"",flat:""},on:{click:t.selectImage}},[s("v-icon",[t._v("image")]),t._v("이미지\n      ")],1)],1),s("div",[s("v-btn",{attrs:{small:"",flat:""},on:{click:t.openFileDialog}},[s("v-icon",[t._v("attach_file")]),t._v("파일첨부\n      ")],1)],1)]),s("input",{ref:"fileInput",staticClass:"d-none",attrs:{multiple:"",id:"file-upload",accept:"application/zip, application/x-zip-compressed, multipart/x-zip, application/x-hwp, application/pdf, image/*, application/vnd.openxmlformats-officedocument.wordprocessingml.*, application/msword, application/vnd.ms-powerpoint, audio/*, video/*, application/vnd.ms-excel, application/haansofthwp, application/haansoftxlsx, application/haansoftxls, application/haansoftpptx, application/haansoftppt, application/haansoftdocx, application/haansoftdoc",type:"file",value:"",capture:"filesystem"},on:{click:function(e){t.$refs.fileInput.value=null},change:t.onFileChange}}),s("v-slide-y-transition",[t.attachedFilenames.length>0?s("v-layout",{staticClass:"border-light",attrs:{wrap:""}},t._l(t.attachedFilenames,function(e,a){return s("v-flex",{key:a,attrs:{xs6:"",md4:"","px-2":""}},[s("v-slide-y-transition",[s("v-layout",{attrs:{row:"","align-center":""}},[s("div",{staticClass:"ellipsis"},[t._v(t._s(e))]),s("v-spacer"),s("v-btn",{staticClass:"short",attrs:{small:""},on:{click:function(e){return t.removeFile(a)}}},[t._v("삭제")])],1)],1)],1)}),1):t._e()],1),t.board.allowAnonymous?s("v-layout",{attrs:{"py-2":"","ml-3":"","justify-center":""}},[s("div",{staticClass:"mr-3"},[s("v-checkbox",{staticClass:"mr-1 my-auto mb-0",attrs:{"hide-details":"",label:"익명"},model:{value:t.isAnonymous,callback:function(e){t.isAnonymous=e},expression:"isAnonymous"}})],1),s("div",[s("v-checkbox",{staticClass:"mr-1 my-auto mb-0",attrs:{disabled:t.isAnonymous,"hide-details":"",label:"익명댓글불가"},model:{value:t.disallowAnonymous,callback:function(e){t.disallowAnonymous=e},expression:"disallowAnonymous"}})],1),s("v-spacer")],1):t._e(),s("v-layout",{attrs:{row:"","mt-3":""}},[s("v-flex",{attrs:{"text-xs-center":""}},[s("v-btn",{on:{click:function(e){return t.$router.go(-1)}}},[t._v("돌아가기")]),s("v-btn",{staticClass:"primary",on:{click:function(e){return t.post()}}},[t._v(t._s(t.documentId?"수정":"등록"))])],1)],1)],1)},i=[],r=s("88dd"),o=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("v-card",[s("v-toolbar",{attrs:{flat:""}},[s("v-toolbar-title",[t._v("설문조사")]),s("v-spacer"),s("v-btn",{staticClass:"toolbar-btn-last",attrs:{icon:""},on:{click:function(e){return t.$emit("closeSurvey")}}},[s("v-icon",[t._v("close")])],1)],1),s("v-card-text",{staticClass:"pb-0"},[s("v-layout",{attrs:{column:""}},[s("div",{staticClass:"border-light",attrs:{id:"surveyMaker"}},t._l(t.currentSurvey.questions,function(e,a){return s("v-flex",{key:a},[s("v-card",{attrs:{flat:""}},[s("v-card-title",{staticClass:"pb-1"},[t._v("\n              "+t._s(a+1)+".\n              "),s("v-text-field",{staticClass:"dense mt-0 pt-0 ml-2",attrs:{"single-line":"","hide-details":"",dense:"",placeholder:"질문 내용","append-outer-icon":"close"},on:{"click:append-outer":function(e){return t.deleteQuestion(a)}},model:{value:e.title,callback:function(s){t.$set(e,"title",s)},expression:"question.title"}})],1),s("v-card-text",{staticClass:"py-0"},[s("v-layout",{attrs:{column:""}},[t._l(e.choices,function(i,r){return s("v-flex",{key:r,staticClass:"mt-2"},[s("v-text-field",{staticClass:"pt-1 dense",attrs:{box:"","single-line":"",placeholder:"선택지"+(r+1),"hide-details":"","append-icon":"delete"},on:{"click:append":function(e){return t.deleteAnswer(a,r)}},model:{value:e.choices[r],callback:function(s){t.$set(e.choices,r,s)},expression:"question.choices[answerIndex]"}})],1)}),s("v-flex",[s("v-layout",{attrs:{row:"","align-center":"","justify-space-around":""}},[s("v-flex",{attrs:{"text-xs-center":""}},[s("v-btn",{attrs:{flat:""},on:{click:function(e){return t.addAnswer(a)}}},[s("v-icon",{staticClass:"mr-1",attrs:{small:""}},[t._v("add")]),t._v("선택지 추가\n                      ")],1)],1),s("v-flex",{attrs:{"text-xs-center":""}},[s("v-checkbox",{staticClass:"mt-0 pt-0",attrs:{"hide-details":"",label:"복수응답 허용"},model:{value:e.allowMultipleChoice,callback:function(s){t.$set(e,"allowMultipleChoice",s)},expression:"question.allowMultipleChoice"}})],1)],1)],1)],2)],1)],1),a!==t.currentSurvey.questions.length-1?s("v-divider",{staticClass:"mx-4"}):t._e()],1)}),1),s("v-flex",{attrs:{"mt-3":""}},[s("v-btn",{attrs:{block:"",flat:""},on:{click:t.pushQuestion}},[s("v-icon",[t._v("playlist_add")]),s("v-label",{attrs:{size:"24"}},[t._v("질문추가")])],1)],1)],1)],1),s("v-card-actions",{staticClass:"align-start"},[s("v-spacer"),s("v-btn",{attrs:{color:"error",depressed:"",disabled:!t.isSurveyDeletable},on:{click:function(e){return t.$emit("deleteSurvey")}}},[t._v("설문 삭제")]),s("v-btn",{attrs:{color:"primary",depressed:""},on:{click:t.extractSurvey}},[t._v("저장")])],1)],1)},n=[],l={props:["survey","isSurveyDeletable","dialog"],data(){return{currentSurvey:{}}},methods:{addAnswer:function(t){this.currentSurvey.questions[t].choices.push("")},deleteAnswer:function(t,e){this.currentSurvey.questions[t].choices.length<3?this.currentSurvey.questions[t].choices[e]&&this.currentSurvey.questions[t].choices[e].length>0?(this.currentSurvey.questions[t].choices[e]="",this.$forceUpdate()):this.$store.dispatch("showSnackbar",{text:"선택지는 2개 이상이어야 합니다.",color:"info"}):this.currentSurvey.questions[t].choices.splice(e,1)},pushQuestion(){this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]})},deleteQuestion(t){1===this.currentSurvey.questions.length?this.currentSurvey.questions[t].title&&this.currentSurvey.questions[t].title.length>0||this.currentSurvey.questions[t].choices.some(t=>t&&t.length>0)?(this.currentSurvey.questions.splice(t,1),this.currentSurvey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]})):this.$store.dispatch("showSnackbar",{text:"최소 하나 이상의 질문을 입력해주세요",color:"warning"}):this.currentSurvey.questions.splice(t,1)},extractSurvey(){let t=0;while(t<this.currentSurvey.questions.length)if(this.currentSurvey.questions[t].title&&this.currentSurvey.questions[t].title.length>0){if(!(this.currentSurvey.questions[t].choices.filter(t=>t&&t.length>0).length>1))return void this.$store.dispatch("showSnackbar",{text:t+1+"번째 질문의 응답을 2개 이상으로 입력해주세요.",color:"info"});this.currentSurvey.questions[t].choices=this.currentSurvey.questions[t].choices.filter(t=>t&&t.length>0),t++}else{if(this.currentSurvey.questions[t].choices.some(t=>t&&t.length>0))return void this.$store.dispatch("showSnackbar",{text:t+1+"번째 질문의 제목을 입력해주세요.",color:"info"});this.currentSurvey.questions.splice(t,1)}0!==t?this.$emit("extractSurvey",this.currentSurvey):this.$store.dispatch("showSnackbar",{text:"질문을 1개 이상 입력해주세요.",color:"warning"})}},watch:{dialog(t){t&&(this.currentSurvey=JSON.parse(JSON.stringify(this.survey)))}}},c=l,u=(s("b76b"),s("0c7c")),h=Object(u["a"])(c,o,n,!1,null,null,null),d=h.exports,v=s("5347"),p={name:"Editor",components:{SurveyMaker:d,Survey:r["a"]},props:["documentId","board"],mixins:[v["a"]],data(){return{savedContent:void 0,link:void 0,title:null,content:"",surveyDialog:!1,survey:{questions:[]},isSurveyDeletable:!1,editorOption:{placeholder:"내용을 입력해주세요.",modules:{toolbar:"#toolbar",magicUrl:{urlRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,globalRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/,normalizeRegularExpression:/(https?:\/\/[\S]+)|(www.[\S]+)|([\S]+.(?:com|kr|org|io|net|me))/},imageDrop:!0,imageResize:!0},theme:this.$vuetify.breakpoint.xsOnly?"bubble":"snow"},show:!1,isAnonymous:!1,disallowAnonymous:!1,formData:void 0,rawFileData:void 0,attachedFilenames:[],attachFromServer:void 0,originImages:[]}},methods:{onEditorChange(t){t.quill;let e=t.html;t.text;this.content=e},async post(){this.title&&""!==this.title.trim()?this.content&&""!==this.content.trim()?this.documentId?await this.uploadModifiedDocument():await this.uploadDocument():this.$store.dispatch("showSnackbar",{text:"글 내용을 입력해주세요.",color:"error"}):this.$store.dispatch("showSnackbar",{text:"글 제목을 입력해주세요.",color:"error"})},async uploadDocument(){return this.formData||(this.formData=new FormData),await this.attachImages(),this.formData.append("boardId",this.$route.params.boardId),this.formData.append("title",this.title),this.formData.append("contents",JSON.stringify(this.$refs.editor.quill.editor.delta)),this.formData.append("isAnonymous",this.isAnonymous),this.formData.append("allowAnonymous",!!this.isAnonymous||!this.disallowAnonymous),this.isSurveyDeletable&&this.formData.append("survey",JSON.stringify(this.survey)),await this.processUploadFiles(),this.$axios.post("/document",this.formData).then(t=>{200===t.status&&this.$router.push(`/${this.$route.params.boardId}/${t.data.documentId}`)}).catch(t=>{console.log(t),this.$store.dispatch("showSnackbar",{text:`${t.response?t.response.data.message:"글을 등록하지 못했습니다. 다시 시도해주세요"}`,color:"error"}),delete this.formData,this.revertImages()})},async uploadModifiedDocument(){try{this.formData||(this.formData=new FormData),this.formData.append("documentId",this.documentId),await this.attachImages(),await this.processFileChange();let e={documentId:this.documentId,title:this.title,contents:JSON.stringify(this.$refs.editor.quill.editor.delta)};return this.$axios.put("/document",e).then(t=>{200===t.status&&(this.$store.dispatch("showSnackbar",{text:"글을 수정하였습니다",color:"success"}),this.$router.push(`/${this.$route.params.boardId}/${this.documentId}`))}).catch(t=>{console.log(t),this.revertImages(),delete this.formData,this.$store.dispatch("showSnackbar",{text:`${t.response?t.response.data.message:"글을 수정하지 못했습니다. 다시 시도해주세요"}`,color:"error"})})}catch(t){console.log(t),this.$store.dispatch("showSnackbar",{text:`${t.response?t.response.data.message:"글을 수정하지 못했습니다. 다시 시도해주세요"}`,color:"error"}),this.revertImages(),delete this.formData}},attachImages(){return this.$refs.editor.quill.editor.delta.ops.forEach(t=>{if(t.insert.hasOwnProperty("image")&&t.insert.image.includes("data:image")){let e=t.insert.image,s=this.uuid()+"."+e.substring("data:image/".length,e.indexOf(";base64"));this.formData.append("attach",this.dataURItoBlob(e),s),t.insert.image=s,this.originImages.push({name:s,src:e})}})},revertImages(){this.$refs.editor.quill.editor.delta.ops.forEach(t=>{if(t.insert.hasOwnProperty("image")){let e=t.insert.image;t.insert.image=this.originImages.find(t=>t.name===e).src}}),this.originImages=[]},async processFileChange(){let t,e,s,a=this.$refs.editor.quill.editor.delta.ops.map(t=>{if(t.insert.hasOwnProperty("image")&&t.insert.image.startsWith("/attach"))return this.attachFromServer.find(e=>t.insert.image==="/"+e.attach_path).attach_id});this.attachFromServer=this.attachFromServer.filter(t=>null!==t),this.attachFromServer.forEach(s=>{s.insert&&!a.filter(t=>void 0!==t).includes(s.attach_id)?t=this.$axios.delete(`/document/attach/${this.documentId}/${s.attach_id}`).catch(t=>{console.log(t)}):this.attachedFilenames.includes(s.attach_name)||s.insert||(e=this.$axios.delete(`/document/attach/${this.documentId}/${s.attach_id}`).catch(t=>{console.log(t)}))}),await this.processUploadFiles();let i=0;for(let r of this.formData.entries())"attach"===r[0]&&(i+=1);i>0&&(s=this.$axios.post("/document/attach",this.formData).catch(t=>{console.log(t)})),await Promise.all([t,e,s]).catch(t=>{console.log(t),this.$store.dispatch("showSnackbar",{text:`${t.response?t.response.data.message:"글을 수정하지 못했습니다. 다시 시도해주세요"}`,color:"error"})})},surveyButtonClick(){this.isSurveyDeletable||0!==this.survey.questions.length||this.survey.questions.push({title:"",allowMultipleChoice:!1,choices:["",""]}),this.surveyDialog=!0},extractSurvey(t){this.surveyDialog=!1,this.survey=JSON.parse(JSON.stringify(t)),this.isSurveyDeletable=!0},closeSurvey(){this.surveyDialog=!1},deleteSurvey(){confirm("작성된 질문 및 내용을 삭제할까요?")&&(this.surveyDialog=!1,this.survey.questions=[],this.isSurveyDeletable=!1)},parseDocument(t){if(this.title=t.title,this.contents=JSON.parse(t.contents),this.attachFromServer=t.attach,this.isAnonymous=t.isAnonymous,t.survey&&(this.survey=t.survey,this.isSurveyDeletable=!0),Array.isArray(t.attach)&&(t.attach=t.attach.filter(t=>null!==t)),t.attach){let e;this.contents.ops.forEach(s=>{s.insert.hasOwnProperty("image")&&(e=t.attach.find(t=>t.attach_name===s.insert.image),e&&(e.insert=!0,s.insert.image=this.webUrl+"/"+e.attach_path))}),this.attachedFilenames=t.attach.filter(t=>!t.insert).map(t=>t.attach_name)}this.$refs.editor.quill.setContents(this.contents)},attachButtonClick(){this.documentId?this.openFileDialog():this.$refs.pond.browse()},openFileDialog(){document.getElementById("file-upload").click()},async onFileChange(t){this.rawFileData||(this.rawFileData=new FormData);var e=this,s=t.target.files||t.dataTransfer.files;if(s.length>0)for(var a=0;a<s.length;a++){if(s[a].size>8388608){this.$store.dispatch("showSnackbar",{text:"8MB 이하의 파일만 첨부가능합니다.",color:"error"});break}await e.rawFileData.append("file",s[a],s[a].name),await e.attachedFilenames.push(s[a].name)}},async removeFile(t){if(this.rawFileData){let e=new FormData,s=0;for(let a of this.rawFileData.entries())"file"===a[0]&&(s!==Number(t)&&await e.append(a[0],a[1],a[1].name),s+=1);this.rawFileData=e}this.attachedFilenames.splice(t,1)},processUploadFiles(){this.rawFileData||(this.rawFileData=new FormData);let t={};for(let e of this.rawFileData.entries())t[e[1].name]={count:t[e[1].name]?t[e[1].name].count+1:1,index:0};for(let e of this.rawFileData.entries()){let s=e[1].name.lastIndexOf("."),a=e[1].name.substring(s,e[1].name.length),i=e[1].name.substring(0,s),r="";t[e[1].name].count>0&&(r=0===t[e[1].name].index?"":` (${t[e[1].name].index})`,t[e[1].name].index+=1),this.formData.append("attach",e[1],i+r+a)}},selectImage(){const t=document.createElement("input");t.setAttribute("type","file"),t.setAttribute("accept","image/*"),t.click();let e=this;t.onchange=(()=>{const s=t.files[0];var a=new FileReader;a.readAsDataURL(s),a.onload=function(){if(/^image\//.test(s.type)){let t=e.$refs.editor.quill.getSelection();e.$refs.editor.quill.insertEmbed(null==t?e.$refs.editor.quill.getLength():t.index,"image",a.result)}else this.$store.dispatch("showSnackbar",{text:"이미지 파일만 업로드할 수 있습니다.",color:"error"})},a.onerror=function(t){console.log("Error: ",t)}})}},computed:{editor(){return this.$refs.editor.quill}},watch:{isAnonymous:{handler(t){t&&(this.disallowAnonymous=!1)}}},created(){this.$route.params.boardId&&this.documentId&&this.$axios.get(`/${this.$route.params.boardId}/${this.documentId}`).then(t=>{this.parseDocument(t.data)}).catch(t=>{console.log(t),this.$store.dispatch("showSnackbar",{text:`${t.response?t.response.data.message:"글 내용을 불러오지 못했습니다."}`,color:"error"}),this.$router.replace("/error?error="+(t&&t.response&&t.response.status||"404"))})}},m=p,y=(s("ace1"),Object(u["a"])(m,a,i,!1,null,null,null));e["default"]=y.exports}}]);
//# sourceMappingURL=chunk-64de6f28.402fc583.js.map